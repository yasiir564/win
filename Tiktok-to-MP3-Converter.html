<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>TokHaste - Free TikTok to MP3 Converter Online</title>
  
  <!-- SEO Meta Tags -->
  <meta name="description" content="Convert TikTok videos to MP3 instantly with TokHaste. Fast, free, and secure TikTok to MP3 downloader. No registration required!" />
  <meta name="keywords" content="TikTok to MP3, TokHaste, TikTok MP3 converter, download TikTok audio, TikTok downloader, convert TikTok to audio" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/inter-ui/3.19.3/inter.min.css">
    <link rel="icon" href="cHJpdmF0ZS9sci9pbWFnZXMvd2Vic2l0ZS8yMDIyLTA1L3JtNTMzLW5lb24tMDA3LXguanBn [MConverter.eu].ico" type="image/x-icon">
      <link rel="canonical" href="https://tokhaste.com/Tiktok-to-MP3-Converter">

    <style>
        :root {
            --tiktok-black: #000000;
            --tiktok-white: #FFFFFF;
            --tiktok-red: #FE2C55;
            --tiktok-blue: #25F4EE;
            --tiktok-light-gray: #F1F1F2;
            --tiktok-dark-gray: #161823;
            --tiktok-darker-gray: #0f1016;
            --tiktok-gradient: linear-gradient(90deg, var(--tiktok-blue), var(--tiktok-red));
            --card-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            --btn-shadow: 0 7px 14px rgba(254, 44, 85, 0.3);
            --font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            --border-radius: 12px;
            --transition: all 0.3s ease;

            /* For dark mode */
            --bg-primary: var(--tiktok-white);
            --text-primary: var(--tiktok-dark-gray);
            --card-bg: var(--tiktok-white);
            --card-border: rgba(0, 0, 0, 0.1);
        }

        [data-theme="dark"] {
            --bg-primary: var(--tiktok-darker-gray);
            --text-primary: var(--tiktok-white);
            --card-bg: var(--tiktok-dark-gray);
            --card-border: rgba(255, 255, 255, 0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: var(--font-family);
        }
        
        body {
            background-color: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            transition: var(--transition);
            scroll-behavior: smooth;
            overflow-x: hidden;
        }

        .section-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 80px 20px;
}

.section-title {
    font-size: 2.5rem;
    font-weight: 700;
    text-align: center;
    margin-bottom: 3rem;
    position: relative;
}

.highlight {
    background: var(--tiktok-gradient);
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
}

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--bg-primary);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--tiktok-red);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(var(--tiktok-blue), var(--tiktok-red));
        }

        /* Navigation */
        .navbar {
            background-color: var(--bg-primary);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
            transition: var(--transition);
        }
        
        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 2rem;
        }
        
        .logo {
            display: flex;
            align-items: center;
            font-weight: 700;
            font-size: 1.5rem;
            background: var(--tiktok-gradient);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .logo i {
            font-size: 1.8rem;
            margin-right: 0.5rem;
        }
        
        .nav-links {
            display: flex;
            gap: 2rem;
        }
        
        .nav-links a {
            color: var(--text-primary);
            text-decoration: none;
            font-weight: 500;
            transition: var(--transition);
            position: relative;
        }
        
        .nav-links a:hover {
            color: var(--tiktok-red);
        }
        
        .nav-links a.active::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 100%;
            height: 2px;
            background: var(--tiktok-gradient);
        }
        
        .nav-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .theme-toggle, .menu-toggle {
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 1.2rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 50%;
            transition: var(--transition);
        }
        
        .theme-toggle:hover, .menu-toggle:hover {
            background-color: rgba(254, 44, 85, 0.1);
            color: var(--tiktok-red);
        }
        
        .btn-sign-in {
            background: var(--tiktok-gradient);
            color: white;
            border: none;
            padding: 0.5rem 1.2rem;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: var(--btn-shadow);
        }
        
        .btn-sign-in:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(254, 44, 85, 0.4);
        }
        
        .menu-toggle {
            display: none;
        }

        /* Main Content */
        main {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 3rem 1rem;
        }
        
        .container {
            max-width: 700px;
            width: 100%;
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            padding: 2.5rem;
            margin-bottom: 2rem;
            border: 1px solid var(--card-border);
            transition: var(--transition);
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        header {
            text-align: center;
            margin-bottom: 2.5rem;
        }
        
        h1 {
            font-size: 2.2rem;
            margin-bottom: 0.5rem;
            background: var(--tiktok-gradient);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            position: relative;
            display: inline-block;
        }
        
        h1::after {
            content: '';
            position: absolute;
            width: 50%;
            height: 4px;
            background: var(--tiktok-gradient);
            bottom: -10px;
            left: 25%;
            border-radius: 10px;
        }
        
        p.subtitle {
            color: var(--text-primary);
            opacity: 0.7;
            font-size: 1.1rem;
            margin-top: 1rem;
        }
        
        .form-group {
            margin-bottom: 2rem;
            position: relative;
        }
        
        label {
            display: block;
            margin-bottom: 0.8rem;
            font-weight: 500;
            color: var(--text-primary);
        }
        
        .input-wrapper {
            position: relative;
            display: flex;
        }
        
        input[type="text"] {
            width: 100%;
            padding: 1rem 3.5rem 1rem 1.2rem;
            border: 2px solid var(--card-border);
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: var(--transition);
            background-color: var(--bg-primary);
            color: var(--text-primary);
        }
        
        input[type="text"]:focus {
            outline: none;
            border-color: var(--tiktok-red);
            box-shadow: 0 0 0 3px rgba(254, 44, 85, 0.2);
        }
        
        .paste-btn {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--tiktok-red);
            font-size: 1.2rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 50%;
            transition: var(--transition);
        }
        
        .paste-btn:hover {
            background-color: rgba(254, 44, 85, 0.1);
        }
        
        button#convert-btn {
            width: 100%;
            padding: 1rem;
            background: var(--tiktok-gradient);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: var(--btn-shadow);
            position: relative;
            overflow: hidden;
            z-index: 1;
        }
        
        button#convert-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: 0.5s;
            z-index: -1;
        }
        
        button#convert-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(254, 44, 85, 0.4);
        }
        
        button#convert-btn:hover::before {
            left: 100%;
        }
        
        button#convert-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        button#convert-btn:disabled::before {
            display: none;
        }
        
        .progress-container {
            margin-top: 2rem;
            display: none;
        }
        
        .progress-container.visible {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        .progress-text {
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text-primary);
            display: flex;
            justify-content: space-between;
        }
        
        .progress-bar-outer {
            width: 100%;
            height: 10px;
            background-color: var(--tiktok-light-gray);
            border-radius: 10px;
            overflow: hidden;
        }
        
        .progress-bar-inner {
            height: 100%;
            background: var(--tiktok-gradient);
            width: 0%;
            border-radius: 10px;
            transition: width 0.3s ease;
        }
        
        .status {
            margin-top: 1.5rem;
            padding: 1rem;
            border-radius: var(--border-radius);
            display: none;
            animation: fadeIn 0.3s ease;
        }
        
        .status.error {
            background-color: rgba(255, 77, 79, 0.1);
            color: #ff4d4f;
            border: 1px solid #ff4d4f;
            display: block;
        }
        
        .status.success {
            background-color: rgba(82, 196, 26, 0.1);
            color: #52c41a;
            border: 1px solid #52c41a;
            display: block;
        }
        
        .status.loading {
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: rgba(0, 0, 0, 0.05);
            color: var(--text-primary);
        }
        
        .spinner {
            width: 24px;
            height: 24px;
            border: 3px solid rgba(254, 44, 85, 0.3);
            border-radius: 50%;
            border-top-color: var(--tiktok-red);
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
        
        .download-section {
            display: none;
            margin-top: 2rem;
            text-align: center;
            animation: fadeIn 0.5s ease;
        }
        
        .download-section.visible {
            display: block;
        }
        
        .audio-info {
            margin-top: 1rem;
            padding: 1.5rem;
            background-color: var(--bg-primary);
            border-radius: var(--border-radius);
            border: 1px solid var(--card-border);
            text-align: left;
        }
        
        .audio-info p {
            margin-bottom: 0.8rem;
            color: var(--text-primary);
        }

        .audio-info p:last-child {
            margin-bottom: 0;
        }
        
        .audio-info p strong {
            font-weight: 600;
            margin-right: 0.5rem;
            color: var(--tiktok-red);
        }
        
        .download-link {
            display: inline-block;
            background: var(--tiktok-gradient);
            color: white;
            text-decoration: none;
            padding: 1rem 2rem;
            border-radius: var(--border-radius);
            font-weight: 600;
            margin-top: 1.5rem;
            transition: var(--transition);
            box-shadow: var(--btn-shadow);
            cursor: pointer;
        }
        
        .download-link:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(254, 44, 85, 0.4);
        }

        /* Footer */
        .footer {
            background-color: var(--card-bg);
            border-top: 1px solid var(--card-border);
            padding: 3rem 0 1.5rem;
            margin-top: auto;
            transition: var(--transition);
        }
        
        .footer-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }
        
        .footer-top {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 2rem;
            margin-bottom: 2rem;
        }
        
        .footer-logo {
            display: flex;
            align-items: center;
            font-weight: 700;
            font-size: 1.5rem;
            background: var(--tiktok-gradient);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .footer-logo i {
            font-size: 1.8rem;
            margin-right: 0.5rem;
        }
        
        .footer-links {
            display: flex;
            flex-wrap: wrap;
            gap: 3rem;
        }
        
        .footer-column h3 {
            font-size: 1.1rem;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }
        
        .footer-column a {
            display: block;
            color: var(--text-primary);
            opacity: 0.7;
            text-decoration: none;
            margin-bottom: 0.7rem;
            transition: var(--transition);
        }
        
        .footer-column a:hover {
            color: var(--tiktok-red);
            opacity: 1;
        }
        
        .footer-bottom {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 1.5rem;
            border-top: 1px solid var(--card-border);
        }
        
        .footer-bottom p {
            color: var(--text-primary);
            opacity: 0.7;
            font-size: 0.9rem;
        }
        
        .social-links {
            display: flex;
            gap: 1rem;
        }
        
        .social-links a {
            color: var(--text-primary);
            font-size: 1.2rem;
            transition: var(--transition);
        }
        
        .social-links a:hover {
            color: var(--tiktok-red);
            transform: translateY(-3px);
        }

        /* Responsive styles */
        @media (max-width: 768px) {
            .nav-links {
                display: none;
            }
            
            .menu-toggle {
                display: block;
            }
            
            .container {
                padding: 1.5rem;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .footer-top {
                flex-direction: column;
                gap: 2rem;
            }
            
            .footer-links {
                gap: 2rem;
            }
            
            .footer-bottom {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }
        }

        @media (max-width: 480px) {
            .nav-container, .footer-container {
                padding: 1rem;
            }
            
            .btn-sign-in {
                display: none;
            }
            
            .container {
                padding: 1.2rem;
            }
            
            h1 {
                font-size: 1.5rem;
            }
            
            .footer-links {
                flex-direction: column;
                gap: 1.5rem;
            }
        }

        /* Mobile menu */
        .mobile-menu {
            position: fixed;
            top: 0;
            right: -100%;
            width: 70%;
            height: 100vh;
            background-color: var(--card-bg);
            padding: 2rem;
            z-index: 1001;
            transition: right 0.3s ease;
            box-shadow: -5px 0 15px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
        }
        
        .mobile-menu.open {
            right: 0;
        }
        
        .mobile-menu-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }
        
        .mobile-menu-close {
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        .mobile-menu-links {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        
        .mobile-menu-links a {
            color: var(--text-primary);
            text-decoration: none;
            font-weight: 500;
            font-size: 1.2rem;
            transition: var(--transition);
        }
        
        .mobile-menu-links a:hover {
            color: var(--tiktok-red);
        }
        
        .mobile-menu-actions {
            margin-top: 2rem;
        }
        
        .mobile-menu-btn {
            width: 100%;
            padding: 0.8rem;
            background: var(--tiktok-gradient);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            display: none;
            transition: var(--transition);
        }
        
        .overlay.open {
            display: block;
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--card-bg);
            color: var(--text-primary);
            padding: 1rem;
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            transform: translateY(100px);
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
            z-index: 1000;
            max-width: 300px;
        }
        
        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }
        
        .toast-content {
            display: flex;
            align-items: center;
        }
        
        .toast-icon {
            margin-right: 10px;
            font-size: 1.2rem;
        }
        
        .toast-icon.success {
            color: #52c41a;
        }
        
        .toast-icon.error {
            color: #ff4d4f;
        }
        
        .toast-icon.info {
            color: var(--tiktok-blue);
        }
        
        .toast-text {
            flex: 1;
        }
        
        .toast-close {
            background: none;
            border: none;
            color: var(--text-primary);
            opacity: 0.5;
            cursor: pointer;
            font-size: 1rem;
            padding: 0 0 0 10px;
        }
        
        .toast-close:hover {
            opacity: 1;
        }

  /* FAQ Section */
.faq {
    background-color: var(--section-bg);
    padding: 2rem 0;
    transition: var(--transition);
}

.faq-container {
    max-width: 800px;
    margin: 0 auto;
    padding: 0 1rem;
}

.faq-item {
    background-color: var(--faq-bg);
    border-radius: var(--border-radius);
    margin-bottom: 1.25rem;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
    overflow: hidden;
    transition: box-shadow 0.4s ease, transform 0.3s ease;
}

.faq-item:hover {
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
    transform: translateY(-2px);
}

.faq-question {
    padding: 1.5rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
    font-weight: 600;
    font-size: 1.1rem;
    color: var(--text-primary);
    transition: color 0.3s ease, background-color 0.3s ease;
    position: relative;
    z-index: 1;
}

.faq-question:hover {
    color: #ff0050;
}

.faq-question::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 0;
    height: 2px;
    background: var(--tiktok-gradient);
    transition: width 0.3s ease;
    z-index: -1;
}

.faq-question:hover::after {
    width: 100%;
}

.faq-question i {
    transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
    color: var(--text-secondary);
}

.faq-question:hover i {
    color: #00f2ea;
}

.faq-question.active i {
    transform: rotate(180deg);
    color: #00f2ea;
}

.faq-answer {
    padding: 0 1.5rem;
    height: 0;
    overflow: hidden;
    color: var(--text-secondary);
    transition: all 0.5s cubic-bezier(0.25, 0.8, 0.25, 1);
    opacity: 0;
}

.faq-question.active + .faq-answer {
    padding: 0 1.5rem 1.5rem;
    height: auto;
    opacity: 1;
}

/* How to Use Section */
.how-to-use {
    background-color: var(--section-bg);
    position: relative;
    padding: 3rem 0;
    transition: var(--transition);
}

.steps-container {
    display: flex;
    justify-content: center;
    align-items: stretch;
    gap: 2rem;
    flex-wrap: wrap;
    margin-top: 3rem;
}

.step-card {
    background-color: var(--faq-bg);
    border-radius: var(--border-radius);
    box-shadow: var(--card-shadow);
    padding: 2.5rem 2rem;
    text-align: center;
    flex: 1;
    min-width: 250px;
    max-width: 300px;
    transition: transform 0.5s cubic-bezier(0.25, 0.8, 0.25, 1), box-shadow 0.5s ease;
    position: relative;
    overflow: hidden;
}

.step-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 4px;
    background: var(--tiktok-gradient);
    transform: scaleX(0);
    transition: transform 0.5s ease;
    transform-origin: left;
}

.step-card:hover {
    transform: translateY(-12px);
    box-shadow: 0 12px 28px rgba(0, 0, 0, 0.15);
}

.step-card:hover::before {
    transform: scaleX(1);
}

.step-icon {
    width: 80px;
    height: 80px;
    margin: 0 auto 1.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--tiktok-gradient);
    border-radius: 50%;
    color: white;
    font-size: 1.8rem;
    position: relative;
    overflow: hidden;
    transition: transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
}

.step-card:hover .step-icon {
    transform: scale(1.1) rotate(5deg);
}

.step-title {
    font-size: 1.4rem;
    margin-bottom: 1rem;
    font-weight: 600;
    color: var(--text-primary);
    transition: color 0.3s ease;
}

.step-card:hover .step-title {
    color: #ff0050;
}

.step-card p {
    color: var(--text-secondary);
    transition: color 0.3s ease;
}

.step-connector {
    height: 2px;
    width: 60px;
    background: var(--tiktok-gradient);
    flex-shrink: 1;
    position: relative;
    overflow: hidden;
}

.step-connector::after {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.6), transparent);
    animation: shimmer 2s infinite;
}

@keyframes shimmer {
    100% {
        left: 100%;
    }
}

/* Media query for responsive design */
@media (max-width: 768px) {
    .steps-container {
        flex-direction: column;
        align-items: center;
    }
    
    .step-connector {
        width: 2px;
        height: 40px;
    }
}

      /* Progress Bar Enhancement - Keeping as is */
.progress-container {
    display: none;
    flex-direction: column;
    width: 100%;
    margin: 20px 0;
    padding: 20px;
    background: var(--card-bg);
    border-radius: var(--border-radius);
    box-shadow: var(--card-shadow);
    border: 1px solid var(--card-border);
    transition: var(--transition);
}
.progress-container.visible {
    display: flex;
    animation: fadeIn 0.5s ease;
}
.progress-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
}
.progress-status {
    font-weight: 600;
    color: var(--text-primary);
}
.progress-percentage {
    font-weight: 700;
    color: var(--tiktok-red);
}
.progress-bar {
    width: 100%;
    height: 12px;
    background-color: var(--tiktok-light-gray);
    border-radius: 10px;
    overflow: hidden;
    position: relative;
}
.progress-bar-inner {
    height: 100%;
    width: 0;
    background: var(--tiktok-gradient);
    border-radius: 10px;
    transition: width 0.3s ease;
    position: relative;
    overflow: hidden;
}
.progress-bar-inner::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(
        90deg,
        rgba(255, 255, 255, 0) 0%,
        rgba(255, 255, 255, 0.2) 50%,
        rgba(255, 255, 255, 0) 100%
    );
    animation: shimmer 2s infinite;
}
.progress-bar-inner.pulse {
    animation: pulse 0.3s ease;
}
.progress-bar-inner.complete {
    animation: complete 1s ease;
}
.progress-text {
    font-size: 14px;
    margin-top: 10px;
    color: var(--tiktok-dark-gray);
    opacity: 0.7;
    min-height: 20px;
    position: relative;
}
.progress-text.typing::after {
    content: '|';
    animation: blink 1s infinite;
}

/* Enhanced Modern Audio Player Styles */
.audio-player-container {
    display: none;
    width: 100%;
    margin: 20px 0;
    padding: 0;
    transition: var(--transition);
}
.audio-player-container.visible {
    display: block;
    animation: slideUp 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
}
.audio-player {
    background: var(--card-bg);
    border-radius: var(--border-radius);
    padding: 24px;
    box-shadow: var(--card-shadow);
    border: 1px solid var(--card-border);
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}
.audio-player:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
}
.audio-player::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 3px;
    background: var(--tiktok-gradient);
    transform: scaleX(0);
    transform-origin: left;
    transition: transform 0.4s ease;
}
.audio-player:hover::before {
    transform: scaleX(1);
}

/* Title and metadata styling */
.audio-info {
    margin-bottom: 15px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.audio-title {
    font-weight: 600;
    color: var(--text-primary);
    font-size: 16px;
    margin: 0;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 70%;
}
.audio-metadata {
    color: var(--tiktok-dark-gray);
    font-size: 12px;
    opacity: 0.7;
}

.audio-controls {
    display: flex;
    align-items: center;
    justify-content: space-between;
    width: 100%;
    gap: 18px;
}
.player-btn {
    background: var(--tiktok-gradient);
    color: var(--tiktok-white);
    border: none;
    border-radius: 50%;
    width: 48px;
    height: 48px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.25s cubic-bezier(0.34, 1.56, 0.64, 1);
    box-shadow: var(--btn-shadow);
    flex-shrink: 0;
    position: relative;
    overflow: hidden;
}
.player-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: radial-gradient(circle at center, rgba(255,255,255,0.2) 0%, rgba(255,255,255,0) 70%);
    opacity: 0;
    transition: opacity 0.3s ease;
}
.player-btn:hover {
    transform: scale(1.08);
    box-shadow: 0 6px 14px rgba(0, 0, 0, 0.15);
}
.player-btn:hover::before {
    opacity: 1;
}
.player-btn:active {
    transform: scale(0.95);
}
.player-btn.pulse {
    animation: enhancedPulse 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
}
.time-slider {
    display: flex;
    align-items: center;
    flex-grow: 1;
    gap: 12px;
    position: relative;
}
.time {
    font-size: 14px;
    color: var(--text-primary);
    min-width: 44px;
    text-align: center;
    font-weight: 500;
    font-variant-numeric: tabular-nums;
    transition: color 0.2s ease;
}
.time.current-time {
    color: var(--tiktok-red);
}
.seek-slider-container {
    position: relative;
    flex-grow: 1;
    height: 20px;
    display: flex;
    align-items: center;
}
.seek-slider {
    flex-grow: 1;
    height: 6px;
    -webkit-appearance: none;
    appearance: none;
    background: #e5e5e5;
    border-radius: 5px;
    outline: none;
    transition: height 0.2s ease;
    position: relative;
    cursor: pointer;
}
.seek-slider:hover {
    height: 8px;
}
.seek-slider-container:hover .seek-preview {
    opacity: 1;
    transform: translateY(0);
}
.seek-preview {
    position: absolute;
    top: -30px;
    padding: 4px 8px;
    background: var(--card-bg);
    border-radius: 4px;
    font-size: 12px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
    pointer-events: none;
    opacity: 0;
    transform: translateY(5px);
    transition: all 0.2s ease;
    border: 1px solid var(--card-border);
}

.volume-controls {
    display: flex;
    align-items: center;
    gap: 12px;
    width: 150px;
    position: relative;
    transition: width 0.3s ease;
}
.volume-controls:hover {
    width: 160px;
}
.volume-slider-container {
    position: relative;
    flex-grow: 1;
}
.volume-slider {
    flex-grow: 1;
    height: 4px;
    -webkit-appearance: none;
    appearance: none;
    background: #e5e5e5;
    border-radius: 5px;
    outline: none;
    transition: all 0.2s ease;
    cursor: pointer;
}
.volume-slider:hover {
    height: 5px;
}

/* Enhanced slider thumb and track styling */
.seek-slider::-webkit-slider-thumb,
.volume-slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 14px;
    height: 14px;
    background: var(--tiktok-red);
    border-radius: 50%;
    cursor: pointer;
    transition: all 0.2s ease;
    box-shadow: 0 1px 4px rgba(0, 0, 0, 0.15);
}

.seek-slider::-moz-range-thumb,
.volume-slider::-moz-range-thumb {
    width: 14px;
    height: 14px;
    background: var(--tiktok-red);
    border-radius: 50%;
    cursor: pointer;
    border: none;
    transition: all 0.2s ease;
    box-shadow: 0 1px 4px rgba(0, 0, 0, 0.15);
}

.seek-slider:hover::-webkit-slider-thumb,
.volume-slider:hover::-webkit-slider-thumb {
    transform: scale(1.2);
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
}

.seek-slider:hover::-moz-range-thumb,
.volume-slider:hover::-moz-range-thumb {
    transform: scale(1.2);
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
}

.seek-slider:active::-webkit-slider-thumb,
.volume-slider:active::-webkit-slider-thumb,
.seek-slider:active::-moz-range-thumb,
.volume-slider:active::-moz-range-thumb {
    transform: scale(1.3);
}

.seek-slider:focus,
.volume-slider:focus {
    background: #d5d5d5;
}

/* Enhanced track fill effect */
.seek-slider-fill, 
.volume-slider-fill {
    position: absolute;
    top: 50%;
    left: 0;
    height: 6px;
    background: var(--tiktok-gradient);
    border-radius: 5px;
    z-index: -1;
    transform: translateY(-50%);
    pointer-events: none;
    transition: width 0.1s ease, height 0.2s ease;
}
.seek-slider:hover + .seek-slider-fill {
    height: 8px;
}
.volume-slider:hover + .volume-slider-fill {
    height: 5px;
}

/* Icon styling */
.player-icon {
    width: 20px;
    height: 20px;
    fill: var(--tiktok-white);
    transition: transform 0.2s ease;
}
.player-btn:hover .player-icon {
    transform: scale(1.1);
}

.volume-icon {
    width: 18px;
    height: 18px;
    fill: var(--text-primary);
    cursor: pointer;
    transition: all 0.2s ease;
}
.volume-icon:hover {
    fill: var(--tiktok-red);
    transform: scale(1.1);
}

/* Additional controls */
.secondary-controls {
    display: flex;
    justify-content: flex-end;
    align-items: center;
    margin-top: 12px;
    gap: 16px;
}
.control-btn {
    background: transparent;
    border: none;
    cursor: pointer;
    padding: 6px;
    border-radius: 50%;
    color: var(--text-primary);
    transition: all 0.2s ease;
    opacity: 0.7;
    display: flex;
    align-items: center;
    justify-content: center;
}
.control-btn:hover {
    opacity: 1;
    background: rgba(0, 0, 0, 0.05);
    transform: translateY(-1px);
}
.control-btn.active {
    color: var(--tiktok-red);
    opacity: 1;
}
.control-icon {
    width: 16px;
    height: 16px;
}

/* Enhanced Animation keyframes */
@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes slideUp {
    from { 
        opacity: 0;
        transform: translateY(20px);
    }
    to { 
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes shimmer {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
}

@keyframes enhancedPulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.12); }
    100% { transform: scale(1); }
}

@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
}

@keyframes complete {
    0% { background: var(--tiktok-gradient); }
    50% { background: var(--tiktok-green); }
    100% { background: var(--tiktok-gradient); }
}

@keyframes blink {
    0%, 100% { opacity: 1; }
    50% { opacity: 0; }
}

@keyframes waveform {
    0% { height: 3px; }
    50% { height: 12px; }
    100% { height: 3px; }
}

/* Playing state animations */
.audio-player.playing .waveform span {
    animation: waveform 0.5s ease infinite;
    animation-delay: calc(var(--i) * 0.05s);
}

.waveform {
    display: none;
    gap: 3px;
    height: 15px;
    align-items: center;
}
.audio-player.playing .waveform {
    display: flex;
}
.waveform span {
    display: inline-block;
    width: 3px;
    height: 3px;
    background: var(--tiktok-red);
    border-radius: 1px;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .volume-controls {
        width: 120px;
    }
    
    .player-btn {
        width: 44px;
        height: 44px;
    }
    
    .time {
        min-width: 40px;
        font-size: 13px;
    }
    
    .secondary-controls {
        gap: 12px;
    }
}

@media (max-width: 480px) {
    .audio-controls {
        flex-wrap: wrap;
    }
    
    .volume-controls {
        width: 100%;
        margin-top: 12px;
    }
    
    .time-slider {
        width: 100%;
    }
    
    .audio-player {
        padding: 20px;
    }
    
    .secondary-controls {
        margin-top: 16px;
        justify-content: space-between;
    }
}
    </style>
</head>
<body>
     <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">
                <i class="fab fa-tiktok"></i>
                <span>TokHaste</span>
            </div>
            
            <div class="nav-links">
                <a href="Tiktok-downloader.html" class="active">Tiktok Downloader</a>
                <a href="Tiktok-to-MP3-Converter.html">TikTok to MP3 Converter</a>
                <a href="Video-to-Audio-Converter.html">MP4 To Mp3 FREE</a>
            </div>
            
            <div class="nav-actions">
                <button class="theme-toggle" id="darkModeToggle" aria-label="Toggle dark mode">
                    <i class="fas fa-moon"></i>
                </button>
                <button class="btn-sign-in">Sign In</button>
                <button class="menu-toggle" id="mobileMenuToggle" aria-label="Toggle menu">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- Mobile Menu -->
    <div class="mobile-menu" id="mobileMenu">
        <div class="mobile-menu-header">
            <div class="logo">
                <i class="fab fa-tiktok"></i>
                <span>TokHaste</span>
            </div>
            <button class="mobile-menu-close" id="mobileMenuClose">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="mobile-menu-links">
            <a href="Tiktok-downloader.html" class="active">Tiktok Downloader</a>
                <a href="Tiktok-to-MP3-Converter.html">TikTok to MP3 Converter</a>
                <a href="Video-to-Audio-Converter.html">MP4 To Mp3 FREE</a>
        </div>
        <div class="mobile-menu-actions">
            <button class="mobile-menu-btn">Sign In</button>
        </div>
    </div>
    <div class="overlay" id="overlay"></div>

    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <div class="toast-content">
            <div class="toast-icon success" id="toastIcon">
                <i class="fas fa-check-circle"></i>
            </div>
            <div class="toast-text" id="toastText">
                Operation successful!
            </div>
            <button class="toast-close" id="toastClose">
                <i class="fas fa-times"></i>
            </button>
        </div>
    </div>

    <!-- Main Content -->
   <main>
  <div class="container">
    <header>
      <h1>TikTok to MP3 Converter</h1>
      <p class="subtitle">Convert TikTok videos into high-quality MP3 audio instantly.</p>
    </header>

    <div class="form-group">
      <label for="tiktok-url">Enter TikTok Video URL</label>
      <div class="input-wrapper">
        <input 
          type="text" 
          id="tiktok-url" 
          placeholder="Paste TikTok video link here" 
          autocomplete="off"
        >
        <button id="paste-btn" class="paste-btn" title="Paste from clipboard">
          <i class="fas fa-paste"></i>
        </button>
      </div>
    </div>
     <!-- Quality Selection -->
            <div class="quality-options">
                <div class="quality-option" data-bitrate="128k">128 kbps</div>
                <div class="quality-option active" data-bitrate="192k">192 kbps</div>
                <div class="quality-option" data-bitrate="320k">320 kbps</div>
            </div>

    <button id="convert-btn">Convert to MP3</button>

    <div id="progress-container" class="progress-container" style="display: none;">
      <div class="progress-header">
        <div id="progress-status" class="progress-status">Preparing...</div>
        <div id="progress-percentage" class="progress-percentage">0%</div>
      </div>
      <div class="progress-bar">
        <div id="progress-bar-inner" class="progress-bar-inner"></div>
      </div>
      <div id="progress-text" class="progress-text"></div>
    </div>

    <div id="status" class="status"></div>

    <div id="audio-player-container" class="audio-player-container" style="display: none;">
      <div class="audio-player">
        <div class="audio-controls">
          <button id="play-pause-btn" class="player-btn play-pause">
            <i class="fas fa-play"></i>
          </button>

          <div class="time-slider">
            <span id="current-time" class="time">0:00</span>
            <input 
              type="range" 
              id="seek-slider" 
              class="seek-slider" 
              min="0" 
              max="100" 
              value="0" 
              step="1"
            >
            <span id="duration-time" class="time">0:00</span>
          </div>

          <div class="volume-controls">
            <button id="volume-btn" class="player-btn volume">
              <i class="fas fa-volume-up"></i>
            </button>
            <input 
              type="range" 
              id="volume-control" 
              class="volume-slider" 
              min="0" 
              max="100" 
              value="70" 
              step="1"
            >
          </div>
        </div>

        <audio id="audio-element"></audio>
      </div>
    </div>

    <a id="download-link" class="download-link" href="#" download style="display: none;">
      <i class="fas fa-download"></i> Download MP3
    </a>
  </div>
</main>


    <!-- How to Use Section -->
<section class="how-to-use">
    <div class="section-container">
        <h2 class="section-title">How to Use <span class="highlight">TokHaste</span> TikTok MP3 Converter</h2>
        
        <div class="steps-container">
            <div class="step-card">
                <div class="step-icon">
                    <i class="fas fa-link"></i>
                </div>
                <h3 class="step-title">Copy Link</h3>
                <p>Copy the TikTok video link from the app or website</p>
            </div>
            
            <div class="step-connector"></div>
            
            <div class="step-card">
                <div class="step-icon">
                    <i class="fas fa-paste"></i>
                </div>
                <h3 class="step-title">Paste URL</h3>
                <p>Paste the link in the input field above</p>
            </div>
            
            <div class="step-connector"></div>
            
            <div class="step-card">
                <div class="step-icon">
                    <i class="fas fa-download"></i>
                </div>
                <h3 class="step-title">Download</h3>
                <p>Click the download button and save your audio in MP3 format</p>
            </div>
        </div>
    </div>
</section>

<!-- FAQ Section -->
<section class="faq" id="faq">
    <div class="section-container">
        <h2 class="section-title">Frequently Asked Questions</h2>
        
        <div class="faq-container">
            <!-- FAQ Item -->
            <div class="faq-item">
                <div class="faq-question" tabindex="0">
                    <span>Is this TikTok MP3 downloader free to use?</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="faq-answer">
                    <p>Yes, our <a href="https://tokhaste.com/Tiktok-to-MP3-Converter" title="Free TikTok MP3 Downloader">TikTok MP3 downloader</a> is 100% free to use with no hidden charges or subscription fees.</p>
                </div>
            </div>

            <!-- FAQ Item -->
            <div class="faq-item">
                <div class="faq-question" tabindex="0">
                    <span>How long does it take to download TikTok audio?</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="faq-answer">
                    <p>Our tool processes and downloads TikTok audio in seconds, providing you with fast MP3 extraction.</p>
                </div>
            </div>

            <!-- FAQ Item -->
            <div class="faq-item">
                <div class="faq-question" tabindex="0">
                    <span>Is there a limit to how many audio files I can download?</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="faq-answer">
                    <p>There is no daily limit. However, we encourage fair usage to keep the service fast and free for all users.</p>
                </div>
            </div>

            <!-- FAQ Item -->
            <div class="faq-item">
                <div class="faq-question" tabindex="0">
                    <span>Which devices are supported?</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="faq-answer">
                    <p>You can use our MP3 downloader on all devices including <strong>Android, iOS, Windows, and Mac</strong> without any installations.</p>
                </div>
            </div>

            <!-- New FAQ Items for MP3 Downloader -->
            <div class="faq-item">
                <div class="faq-question" tabindex="0">
                    <span>Do I need to log in or sign up?</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="faq-answer">
                    <p>No login or registration is required. Just paste the video link and start downloading MP3 audio instantly.</p>
                </div>
            </div>

            <div class="faq-item">
                <div class="faq-question" tabindex="0">
                    <span>Is this TikTok MP3 downloader safe?</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="faq-answer">
                    <p>Yes, our platform is secure and respects your privacy. We do not store or track any user data. Read more on our <a href="https://tokhaste.com/privacypolicy" title="Privacy Policy">Privacy Policy</a> page.</p>
                </div>
            </div>

            <div class="faq-item">
                <div class="faq-question" tabindex="0">
                    <span>What is the quality of the downloaded MP3 files?</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="faq-answer">
                    <p>We extract audio at the highest quality available from the original TikTok video to provide you with the best MP3 experience â€” or you can use our <a href="https://tokhaste.com/Video-to-Audio-Converter" target="_blank">free Video to Audio converter</a> for quick and easy conversions.</p>
                </div>
            </div>

            <div class="faq-item">
                <div class="faq-question" tabindex="0">
                    <span>How do I download TikTok audio using this tool?</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="faq-answer">
                    <p>It's easy! Copy the TikTok video URL, paste it into our <a href="https://tokhaste.com/Tiktok-to-MP3-Converter" title="Online TikTok MP3 Downloader">TikTok MP3 downloader tool</a>, and click "Download".</p>
                </div>
            </div>

            <div class="faq-item">
                <div class="faq-question" tabindex="0">
                    <span>Can I use this tool on iPhone or iPad?</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="faq-answer">
                    <p>Yes, our MP3 downloader works seamlessly on iPhone and iPad. For best results, use Safari or Chrome browser.</p>
                </div>
            </div>

            <div class="faq-item">
                <div class="faq-question" tabindex="0">
                    <span>Can I download TikTok videos as well?</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="faq-answer">
                    <p>Yes, TokHaste also offers a <a href="https://tokhaste.com/" title="TikTok Video Downloader">TikTok video downloader</a> if you prefer to save the entire video instead of just the audio.</p>
                </div>
            </div>
        </div>
    </div>
</section>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-container">
            <div class="footer-top">
                <div class="footer-logo">
                    <i class="fab fa-tiktok"></i>
                    <span>TokHaste</span>
                </div>
                <div class="footer-links">
                    <div class="footer-column">
                        <h3>Pages</h3>
                        <a href="Tiktok-downloader.html">Home</a>
                        <a href="privacypolicy.html">Privacy Policy</a>
                    </div>
                    <div class="footer-column">
                        <h3>Our Tools</h3>
                        <a href="Tiktok-downloader.html">Tiktok Downloader</a>
                        <a href="Tiktok-to-MP3-Converter.html">Tiktok To Mp3</a>
                        <a href="Video-to-Audio-Converter.html">Video To Mp3</a>
                    </div>
                    <div class="footer-column">
                        <h3>Legal</h3>
                        <a href="Terms of services.html">Terms of Service</a>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 TokHaste. All rights reserved.</p>
                <div class="social-links">
                    <a href="#" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                    <a href="#" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
                    <a href="#" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                </div>
            </div>
        </div>
    </footer>


    <script>
document.addEventListener('DOMContentLoaded', function() {
    // Cache DOM elements
    const elements = {
        urlInput: document.getElementById('tiktok-url'),
        pasteBtn: document.getElementById('paste-btn'),
        convertBtn: document.getElementById('convert-btn'),
        statusDiv: document.getElementById('status'),
        progressContainer: document.getElementById('progress-container'),
        progressStatus: document.getElementById('progress-status'),
        progressPercentage: document.getElementById('progress-percentage'),
        progressBarInner: document.getElementById('progress-bar-inner'),
        progressText: document.getElementById('progress-text'),
        downloadSection: document.getElementById('download-section') || document.createElement('div'), // Create if missing
        downloadLink: document.getElementById('download-link'),
        qualityOptions: document.querySelectorAll('.quality-option'),
        darkModeToggle: document.getElementById('darkModeToggle') || document.createElement('button'), // Create if missing
        body: document.body,
        mobileMenuToggle: document.getElementById('mobileMenuToggle') || document.createElement('button'), // Create if missing
        mobileMenu: document.getElementById('mobileMenu') || document.createElement('div'), // Create if missing
        mobileMenuClose: document.getElementById('mobileMenuClose') || document.createElement('button'), // Create if missing
        overlay: document.getElementById('overlay') || document.createElement('div'), // Create if missing
        toast: document.getElementById('toast'),
        toastText: document.getElementById('toastText'),
        toastIcon: document.getElementById('toastIcon'),
        toastClose: document.getElementById('toastClose'),
        audioPlayer: document.getElementById('audio-player-container'),
        audioElement: document.getElementById('audio-element'),
        playPauseBtn: document.getElementById('play-pause-btn'),
        seekSlider: document.getElementById('seek-slider'),
        currentTimeEl: document.getElementById('current-time'),
        durationEl: document.getElementById('duration-time'),
        volumeControl: document.getElementById('volume-control'),
        volumeBtn: document.getElementById('volume-btn'),
        turnstileContainer: document.getElementById('cf-turnstile') || createTurnstileContainer()
    };

    // Create Turnstile container if missing
    function createTurnstileContainer() {
        const container = document.createElement('div');
        container.id = 'cf-turnstile';
        container.className = 'turnstile-container';
        
        // Create hidden input for token
        const tokenInput = document.createElement('input');
        tokenInput.type = 'hidden';
        tokenInput.id = 'cf-turnstile-response';
        container.appendChild(tokenInput);
        
        // Insert before convert button
        if (elements.convertBtn && elements.convertBtn.parentNode) {
            elements.convertBtn.parentNode.insertBefore(container, elements.convertBtn);
        } else {
            document.querySelector('.form-group')?.appendChild(container);
        }
        
        return container;
    }

    // Create download section if missing
    if (!document.getElementById('download-section')) {
        const downloadSection = document.createElement('div');
        downloadSection.id = 'download-section';
        downloadSection.className = 'download-section';
        if (elements.progressContainer && elements.progressContainer.parentNode) {
            elements.progressContainer.parentNode.insertBefore(downloadSection, elements.progressContainer.nextSibling);
        }
    }

    // Constants
    const API_URL = 'https://mainpy-v09m.onrender.com/api/convert';
    const TOAST_DURATION = 3000;
    const TURNSTILE_SITE_KEY = '0x4AAAAAABHoxdccCZ_9Cezk';
    
    // Optimized conversion stages with meaningful messages
    const CONVERSION_STAGES = [
        { 
            threshold: 10, 
            message: 'Initializing download process...', 
            subtext: 'Preparing conversion environment',
            icon: 'fa-rocket'
        },
        { 
            threshold: 25, 
            message: 'Analyzing TikTok video content...', 
            subtext: 'Extracting media information',
            icon: 'fa-search'
        },
        { 
            threshold: 45, 
            message: 'Extracting audio stream...', 
            subtext: 'Separating audio from video',
            icon: 'fa-headphones'
        },
        { 
            threshold: 65, 
            message: 'Processing audio...', 
            subtext: 'Applying quality settings',
            icon: 'fa-sliders-h'
        },
        { 
            threshold: 85, 
            message: 'Finalizing MP3 conversion...', 
            subtext: 'Removing metadata and preparing download',
            icon: 'fa-file-audio'
        }
    ];

    // Initialize features
    initDarkMode();
    initEventListeners();
    detectClipboardUrl();
    initAudioPlayer();
    initTurnstile();

    // Dark mode functionality
    function initDarkMode() {
        const isDarkMode = localStorage.getItem('darkMode') === 'true';
        if (isDarkMode) {
            elements.body.setAttribute('data-theme', 'dark');
            if (elements.darkModeToggle.innerHTML) {
                elements.darkModeToggle.innerHTML = '<i class="fas fa-sun"></i>';
            }
        }
    }

    // Initialize Cloudflare Turnstile with proper error handling
    function initTurnstile() {
        if (!elements.turnstileContainer) return;
        
        // Ensure Turnstile container is visible
        elements.turnstileContainer.style.display = 'block';
        
        // We need to wait for the Turnstile script to load
        function renderTurnstile() {
            if (window.turnstile) {
                try {
                    window.turnstile.render('#cf-turnstile', {
                        sitekey: TURNSTILE_SITE_KEY,
                        theme: elements.body.getAttribute('data-theme') === 'dark' ? 'dark' : 'light',
                        callback: function(token) {
                            const tokenInput = document.getElementById('cf-turnstile-response');
                            if (tokenInput) {
                                tokenInput.value = token;
                            }
                            enableConvertButton();
                        },
                        'error-callback': function() {
                            console.error('Turnstile encountered an error');
                            showToast('Security verification failed. Please try again.', 'error');
                        },
                        'expired-callback': function() {
                            if (window.turnstile) {
                                window.turnstile.reset('#cf-turnstile');
                            }
                            showToast('Security verification expired. Please verify again.', 'warning');
                        }
                    });
                } catch (error) {
                    console.error('Failed to initialize Turnstile:', error);
                    enableConvertButton(); // Fallback if Turnstile fails
                }
            } else {
                console.warn('Turnstile not available. Security verification might not work.');
                setTimeout(renderTurnstile, 500); // Try again in 500ms
            }
        }
        
        if (document.readyState === 'complete') {
            renderTurnstile();
        } else {
            window.addEventListener('load', renderTurnstile);
        }
    }
    
    // Enable convert button
    function enableConvertButton() {
        if (elements.convertBtn) {
            elements.convertBtn.disabled = false;
        }
    }

    // Set up all event listeners
    function initEventListeners() {
        // Dark mode toggle
        if (elements.darkModeToggle && elements.darkModeToggle.tagName) {
            elements.darkModeToggle.addEventListener('click', toggleDarkMode);
        }

        // Mobile menu
        if (elements.mobileMenuToggle && elements.mobileMenuToggle.tagName) {
            elements.mobileMenuToggle.addEventListener('click', openMobileMenu);
        }
        if (elements.mobileMenuClose && elements.mobileMenuClose.tagName) {
            elements.mobileMenuClose.addEventListener('click', closeMobileMenu);
        }
        if (elements.overlay && elements.overlay.tagName) {
            elements.overlay.addEventListener('click', closeMobileMenu);
        }

        // Toast
        if (elements.toastClose) {
            elements.toastClose.addEventListener('click', hideToast);
        }

        // Paste button
        if (elements.pasteBtn) {
            elements.pasteBtn.addEventListener('click', pasteFromClipboard);
        }

        // Convert button
        if (elements.convertBtn) {
            elements.convertBtn.addEventListener('click', convertTikTokToMp3);
        }

        // Enter key to submit
        if (elements.urlInput) {
            elements.urlInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && elements.convertBtn && !elements.convertBtn.disabled) {
                    elements.convertBtn.click();
                }
            });
        }
        
        // Quality selector
        if (elements.qualityOptions) {
            elements.qualityOptions.forEach(option => {
                option.addEventListener('click', function() {
                    elements.qualityOptions.forEach(opt => opt.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Add ripple effect
                    const ripple = document.createElement('span');
                    ripple.classList.add('ripple');
                    this.appendChild(ripple);
                    
                    setTimeout(() => {
                        ripple.remove();
                    }, 600);
                });
            });
        }

        // FAQ Accordion Functionality
        const faqQuestions = document.querySelectorAll('.faq-question');
        faqQuestions.forEach(question => {
            question.addEventListener('click', () => {
                question.classList.toggle('active');
                
                const answer = question.nextElementSibling;
                if (answer && answer.classList.contains('faq-answer')) {
                    if (answer.style.maxHeight) {
                        answer.style.maxHeight = null;
                    } else {
                        answer.style.maxHeight = answer.scrollHeight + 'px';
                    }
                    
                    const chevron = question.querySelector('.fa-chevron-down');
                    if (chevron) {
                        chevron.classList.toggle('rotate');
                    }
                }
            });

            // Add keyboard support
            question.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    question.click();
                }
            });
        });
    }

    // Initialize audio player with optimized event handling
    function initAudioPlayer() {
        if (!elements.audioElement) return;
        
        // Play/Pause button
        if (elements.playPauseBtn) {
            elements.playPauseBtn.addEventListener('click', togglePlayPause);
        }
        
        // Update seek slider as audio plays
        elements.audioElement.addEventListener('timeupdate', updateSeekSlider);
        
        // Allow seeking
        if (elements.seekSlider) {
            elements.seekSlider.addEventListener('input', seekAudio);
        }
        
        // Update duration when metadata is loaded
        elements.audioElement.addEventListener('loadedmetadata', function() {
            if (elements.durationEl) {
                elements.durationEl.textContent = formatTime(elements.audioElement.duration);
            }
            if (elements.seekSlider) {
                elements.seekSlider.max = Math.floor(elements.audioElement.duration);
            }
        });
        
        // Handle volume control
        if (elements.volumeControl) {
            elements.volumeControl.addEventListener('input', function() {
                elements.audioElement.volume = this.value / 100;
                updateVolumeIcon(this.value);
            });
        }
        
        // Handle volume button click (mute/unmute)
        if (elements.volumeBtn) {
            elements.volumeBtn.addEventListener('click', toggleMute);
        }
        
        // Reset player when audio ends
        elements.audioElement.addEventListener('ended', function() {
            if (elements.playPauseBtn) {
                elements.playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
            }
            if (elements.seekSlider) {
                elements.seekSlider.value = 0;
            }
            if (elements.currentTimeEl) {
                elements.currentTimeEl.textContent = '0:00';
            }
        });
    }

    // Toggle play/pause
    function togglePlayPause() {
        if (!elements.audioElement) return;
        
        if (elements.audioElement.paused) {
            elements.audioElement.play()
                .then(() => {
                    elements.playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
                })
                .catch(err => {
                    console.error('Failed to play audio:', err);
                    showToast('Failed to play audio. Please try again.', 'error');
                });
            
            elements.playPauseBtn.classList.add('pulse');
            setTimeout(() => {
                elements.playPauseBtn.classList.remove('pulse');
            }, 300);
        } else {
            elements.audioElement.pause();
            elements.playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
        }
    }

    // Update seek slider and current time
    function updateSeekSlider() {
        if (!elements.audioElement || !elements.seekSlider || !elements.currentTimeEl) return;
        
        const currentTime = Math.floor(elements.audioElement.currentTime);
        elements.seekSlider.value = currentTime;
        elements.currentTimeEl.textContent = formatTime(currentTime);
        
        // Calculate gradient percentage for the seek slider
        const percentage = (currentTime / elements.audioElement.duration) * 100;
        elements.seekSlider.style.background = `linear-gradient(to right, var(--tiktok-red) 0%, var(--tiktok-blue) ${percentage}%, #e5e5e5 ${percentage}%, #e5e5e5 100%)`;
    }

    // Seek audio
    function seekAudio() {
        if (!elements.audioElement || !elements.seekSlider) return;
        elements.audioElement.currentTime = elements.seekSlider.value;
    }

    // Toggle mute
    function toggleMute() {
        if (!elements.audioElement || !elements.volumeBtn || !elements.volumeControl) return;
        
        elements.audioElement.muted = !elements.audioElement.muted;
        
        if (elements.audioElement.muted) {
            elements.volumeBtn.innerHTML = '<i class="fas fa-volume-mute"></i>';
            elements.volumeControl.value = 0;
        } else {
            updateVolumeIcon(elements.volumeControl.value);
            elements.volumeControl.value = elements.audioElement.volume * 100;
        }
    }

    // Update volume icon based on level
    function updateVolumeIcon(volumeLevel) {
        if (!elements.volumeBtn) return;
        
        if (volumeLevel == 0) {
            elements.volumeBtn.innerHTML = '<i class="fas fa-volume-mute"></i>';
        } else if (volumeLevel < 50) {
            elements.volumeBtn.innerHTML = '<i class="fas fa-volume-down"></i>';
        } else {
            elements.volumeBtn.innerHTML = '<i class="fas fa-volume-up"></i>';
        }
    }

    // Format time in seconds to MM:SS
    function formatTime(seconds) {
        if (!seconds || isNaN(seconds)) return '0:00';
        
        seconds = Math.round(parseFloat(seconds));
        const minutes = Math.floor(seconds / 60);
        const remainingSeconds = seconds % 60;
        return `${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;
    }

    // Dark mode toggle function
    function toggleDarkMode() {
        const isDarkMode = elements.body.getAttribute('data-theme') === 'dark';
        
        if (isDarkMode) {
            elements.body.removeAttribute('data-theme');
            elements.darkModeToggle.innerHTML = '<i class="fas fa-moon"></i>';
            localStorage.setItem('darkMode', 'false');
        } else {
            elements.body.setAttribute('data-theme', 'dark');
            elements.darkModeToggle.innerHTML = '<i class="fas fa-sun"></i>';
            localStorage.setItem('darkMode', 'true');
        }
        
        // Update Turnstile theme
        if (window.turnstile) {
            try {
                window.turnstile.remove('#cf-turnstile');
                initTurnstile();
            } catch (err) {
                console.error('Failed to reset Turnstile:', err);
            }
        }
    }
    
    // Mobile menu functions
    function openMobileMenu() {
        if (!elements.mobileMenu || !elements.overlay) return;
        
        elements.mobileMenu.classList.add('open');
        elements.overlay.classList.add('open');
        document.body.style.overflow = 'hidden';
    }

    function closeMobileMenu() {
        if (!elements.mobileMenu || !elements.overlay) return;
        
        elements.mobileMenu.classList.remove('open');
        elements.overlay.classList.remove('open');
        document.body.style.overflow = '';
    }

    // Toast notification function
    function showToast(message, type = 'success') {
        if (!elements.toast || !elements.toastText || !elements.toastIcon) return;
        
        const iconMap = {
            success: 'fa-check-circle',
            error: 'fa-exclamation-circle',
            info: 'fa-info-circle',
            warning: 'fa-exclamation-triangle'
        };
        
        elements.toastIcon.className = 'toast-icon ' + type;
        elements.toastIcon.innerHTML = `<i class="fas ${iconMap[type] || iconMap.success}"></i>`;
        elements.toastText.textContent = message;
        
        elements.toast.classList.add('show');
        
        if (window.toastTimeout) {
            clearTimeout(window.toastTimeout);
        }
        
        window.toastTimeout = setTimeout(hideToast, TOAST_DURATION);
    }

    function hideToast() {
        if (!elements.toast) return;
        elements.toast.classList.remove('show');
    }

    // Paste functionality
    async function pasteFromClipboard() {
        if (!elements.urlInput) return;
        
        try {
            // Check if clipboard API is available
            if (!navigator.clipboard || !navigator.clipboard.readText) {
                throw new Error('Clipboard API not available');
            }
            
            const text = await navigator.clipboard.readText();
            elements.urlInput.value = text;
            
            if (isValidTikTokUrl(text)) {
                showToast('TikTok URL pasted from clipboard', 'info');
            } else {
                showToast('URL pasted, but it doesn\'t appear to be a valid TikTok URL', 'warning');
            }
        } catch (err) {
            console.error('Clipboard error:', err);
            showToast('Failed to read clipboard. Please paste manually.', 'error');
        }
    }

    // Enhanced URL validation with support for various TikTok URL formats
    function isValidTikTokUrl(url) {
        if (!url) return false;
        
        const regex = /^(https?:\/\/)?(www\.|vm\.|vt\.)?(tiktok\.com)(\/(@[\w.-]+\/video\/\d+|\w+\/\w+\/\w+|v\/\w+|[A-Za-z0-9]+))/;
        return regex.test(url);
    }

    // Reset UI elements before conversion
    function resetUI() {
        if (elements.progressContainer) {
            elements.progressContainer.classList.remove('visible');
        }
        
        if (elements.statusDiv) {
            elements.statusDiv.style.display = 'none';
        }
        
        // Get downloadSection if it exists now (might have been created after initial load)
        const downloadSection = document.getElementById('download-section');
        if (downloadSection) {
            downloadSection.classList.remove('visible');
        }
        
        if (elements.audioPlayer) {
            elements.audioPlayer.classList.remove('visible');
        }
        
        // Reset audio player
        if (elements.audioElement) {
            elements.audioElement.pause();
            elements.audioElement.src = '';
            
            if (elements.playPauseBtn) {
                elements.playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
            }
        }
    }

    // Optimized progress animation
    function startProgressAnimation() {
        let progress = 0;
        let currentStageIndex = 0;
        
        // Safety check for required elements
        if (!elements.progressBarInner || !elements.progressPercentage || 
            !elements.progressStatus || !elements.progressText) {
            console.error('Missing progress UI elements');
            return setInterval(() => {}, 1000); // Return dummy interval
        }
        
        return setInterval(() => {
            if (progress < 95) {
                // Calculate a realistic increment with slight randomness for natural feel
                const increment = 0.5 + Math.random() * 1.5;
                progress += increment;
                
                // Check if we need to update the stage message
                while (currentStageIndex < CONVERSION_STAGES.length && 
                      progress >= CONVERSION_STAGES[currentStageIndex].threshold) {
                    const stage = CONVERSION_STAGES[currentStageIndex];
                    
                    // Update message with fade effect
                    elements.progressStatus.classList.add('fade-out');
                    
                    setTimeout(() => {
                        elements.progressStatus.innerHTML = `<i class="fas ${stage.icon}"></i> ${stage.message}`;
                        elements.progressStatus.classList.remove('fade-out');
                        elements.progressStatus.classList.add('fade-in');
                        
                        setTimeout(() => {
                            elements.progressStatus.classList.remove('fade-in');
                        }, 300);
                    }, 300);
                    
                    // Update subtext with typing animation
                    updateProgressSubtext(stage.subtext);
                    
                    currentStageIndex++;
                }
                
                // Update progress bar and percentage
                elements.progressBarInner.style.width = `${progress}%`;
                elements.progressPercentage.textContent = `${Math.round(progress)}%`;
                
                // Add occasional pulsing animation for visual feedback
                if (progress % 10 < 0.5) {
                    elements.progressBarInner.classList.add('pulse');
                    setTimeout(() => {
                        elements.progressBarInner.classList.remove('pulse');
                    }, 300);
                }
            }
        }, 350);
    }
    
    // Typing animation for progress subtext
    function updateProgressSubtext(text) {
        if (!elements.progressText) return;
        
        elements.progressText.textContent = '';
        elements.progressText.classList.add('typing');
        
        let i = 0;
        const typingInterval = setInterval(() => {
            if (i < text.length) {
                elements.progressText.textContent += text.charAt(i);
                i++;
            } else {
                clearInterval(typingInterval);
                setTimeout(() => {
                    elements.progressText.classList.remove('typing');
                }, 500);
            }
        }, 50);
    }

    // Helper function to extract filename from the Content-Disposition header
    function getFilenameFromResponse(response) {
        if (!response || !response.headers) return null;
        
        const contentDisposition = response.headers.get('Content-Disposition');
        if (!contentDisposition) return null;
        
        const matches = /filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/.exec(contentDisposition);
        if (matches && matches[1]) {
            return matches[1].replace(/['"]/g, '');
        }
        return null;
    }

    // Handle specific error types
    function handleError(error, response) {
        let errorMessage = 'Failed to convert TikTok to MP3. Please try again.';
        
        if (!navigator.onLine) {
            errorMessage = 'No internet connection. Please check your network and try again.';
        }
        else if (response && response.status >= 500) {
            errorMessage = 'Server error. Our service is experiencing issues. Please try again later.';
        }
        else if (response && response.status === 429) {
            errorMessage = 'Too many requests. Please wait a moment and try again.';
        }
        else if (response && response.status === 404) {
            errorMessage = 'Video not found. The TikTok may be private or deleted.';
        }
        else if (response && response.status === 400) {
            errorMessage = 'Invalid request. Please check the TikTok URL format.';
        }
        else if (error.message) {
            errorMessage = error.message;
        }
        
        return errorMessage;
    }

    // Scroll to element function with smooth animation
    function scrollToElement(element) {
        if (!element) return;
        
        const elementPosition = element.getBoundingClientRect().top + window.pageYOffset;
        const offset = 80; // Offset for fixed headers
        
        window.scrollTo({
            top: elementPosition - offset,
            behavior: 'smooth'
        });
    }

    // Display completion and download section with proper metadata handling
    function displayCompletionUI(data, removeMetadata = true) {
        // Complete progress
        if (elements.progressBarInner) elements.progressBarInner.style.width = '100%';
        if (elements.progressPercentage) elements.progressPercentage.textContent = '100%';
        if (elements.progressStatus) elements.progressStatus.innerHTML = '<i class="fas fa-check-circle"></i> Conversion complete!';
        if (elements.progressText) elements.progressText.textContent = 'Your MP3 is ready';
        
        // Add completion animation
        if (elements.progressBarInner) elements.progressBarInner.classList.add('complete');
        
        // Generate a clean filename with no metadata
        const cleanFilename = `TikTok_Audio_${Date.now()}.mp3`;
        if (elements.downloadLink) {
            elements.downloadLink.download = cleanFilename;
            elements.downloadLink.style.display = 'flex';
        }
        
        // Set up audio player if we have a valid audio URL
        if (elements.audioElement && elements.downloadLink && elements.downloadLink.href) {
            elements.audioElement.src = elements.downloadLink.href;
            elements.audioElement.volume = 0.7;
            
            if (elements.volumeControl) elements.volumeControl.value = 70;
            if (elements.currentTimeEl) elements.currentTimeEl.textContent = '0:00';
            
            // Set duration if available
            if (data && data.duration && elements.durationEl) {
                elements.durationEl.textContent = formatTime(data.duration);
            } else if (elements.durationEl) {
                elements.durationEl.textContent = '0:00';
            }
        }
        
        // Show download section and audio player
        const downloadSection = document.getElementById('download-section');
        if (downloadSection) downloadSection.classList.add('visible');
        if (elements.audioPlayer) elements.audioPlayer.classList.add('visible');
        
        // Try to auto-play audio with error handling
        if (elements.audioElement && elements.playPauseBtn) {
            elements.audioElement.play().then(() => {
                elements.playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
            }).catch(error => {
                console.log('Auto-play prevented by browser:', error);
                elements.playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
            });
        }
        
        // Scroll to download section
        setTimeout(() => {
            scrollToElement(downloadSection || elements.downloadLink);
        }, 500);
    }

    // Main conversion function with metadata removal and Turnstile verification
    async function convertTikTokToMp3() {
        if (!elements.urlInput) return;
        
        const url = elements.urlInput.value.trim();
        
        // Reset UI
        resetUI();
        
        // Validate URL
        if (!url) {
            showToast('Please enter a TikTok URL', 'error');
            return;
        }
        
        if (!isValidTikTokUrl(url)) {
            showToast('Please enter a valid TikTok URL', 'error');
            return;
        }
        
        // Check if Turnstile is available and completed
        const turnstileResponse = document.getElementById('cf-turnstile-response');
        const turnstileRequired = !!elements.turnstileContainer && 
                                window.turnstile && 
                                turnstileResponse;
                                
        if (turnstileRequired && (!turnstileResponse || !turnstileResponse.value)) {
            showToast('Please complete the security verification', 'warning');
            
            // Reset Turnstile to prompt user
            if (window.turnstile) {
                try {
                    window.turnstile.reset('#cf-turnstile');
                } catch (err) {
                    console.error('Failed to reset Turnstile:', err);
                }
            }
            return;
        }
        
        // Get selected quality from active quality option
        let selectedQuality = '192k'; // Default quality
        document.querySelectorAll('.quality-option').forEach(option => {
            if (option.classList.contains('active') && option.dataset.bitrate) {
                selectedQuality = option.dataset.bitrate;
            }
        });
        
        // Show progress
        if (elements.progressContainer) {
            elements.progressContainer.classList.add('visible');
        }
        if (elements.progressStatus) {
            elements.progressStatus.innerHTML = '<i class="fas fa-rocket"></i> Initializing...';
        }
        if (elements.progressText) {
            elements.progressText.textContent = 'Getting ready';
        }
        if (elements.progressPercentage) {
            elements.progressPercentage.textContent = '0%';
        }
        if (elements.progressBarInner) {
            elements.progressBarInner.style.width = '0%';
        }
        if (elements.convertBtn) {
            elements.convertBtn.disabled = true;
        }
        
        // Scroll to progress
        scrollToElement(elements.progressContainer);
        
        // Start progress animation
        const progressInterval = startProgressAnimation();
        
        try {
            // Set up request with timeout
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), 120000); // 2 minute timeout
            
            // Prepare request data
            const requestData = { 
                url: url,
                quality: selectedQuality,
                remove_metadata: true // Request server to strip metadata
            };
            
            // Add turnstile token if available
            if (turnstileResponse && turnstileResponse.value) {
                requestData.turnstile_token = turnstileResponse.value;}
            
            // Make API request
            const response = await fetch(API_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(requestData),
                signal: controller.signal
            });
            
            clearTimeout(timeoutId);
            
            // Check for errors
            if (!response.ok) {
                throw new Error(`Server responded with ${response.status}`);
            }
            
            // Handle response
            const blob = await response.blob();
            const audioUrl = URL.createObjectURL(blob);
            
            // Try to get filename from response headers
            let filename = getFilenameFromResponse(response);
            if (!filename) {
                // Create a default filename if none provided
                filename = `TikTok_Audio_${Date.now()}.mp3`;
            }
            
            // Set download link
            if (elements.downloadLink) {
                elements.downloadLink.href = audioUrl;
                elements.downloadLink.download = filename;
            }
            
            // Show completion UI
            clearInterval(progressInterval);
            displayCompletionUI({
                duration: null // Server doesn't provide duration yet
            });
            
            // Update status
            if (elements.statusDiv) {
                elements.statusDiv.style.display = 'block';
                elements.statusDiv.textContent = 'Conversion completed successfully!';
                elements.statusDiv.className = 'status success';
            }
            
            showToast('TikTok converted to MP3 successfully!', 'success');
            
        } catch (error) {
            // Stop progress animation
            clearInterval(progressInterval);
            
            console.error('Conversion error:', error);
            
            // Handle specific error cases
            const errorMessage = handleError(error, error.response);
            
            // Show error in UI
            if (elements.statusDiv) {
                elements.statusDiv.style.display = 'block';
                elements.statusDiv.textContent = errorMessage;
                elements.statusDiv.className = 'status error';
            }
            
            if (elements.progressContainer) {
                elements.progressContainer.classList.remove('visible');
            }
            
            showToast(errorMessage, 'error');
            
        } finally {
            // Re-enable convert button
            if (elements.convertBtn) {
                elements.convertBtn.disabled = false;
            }
            
            // Reset Turnstile for next conversion
            if (window.turnstile) {
                try {
                    window.turnstile.reset('#cf-turnstile');
                } catch (err) {
                    console.error('Failed to reset Turnstile:', err);
                }
            }
        }
    }

    // Auto-detect clipboard URLs when page loads
    function detectClipboardUrl() {
        if (!navigator.clipboard || !navigator.clipboard.readText) {
            console.log('Clipboard API not available for auto-detection');
            return;
        }
        
        // Only try to auto-detect if URL input is empty
        if (elements.urlInput && elements.urlInput.value.trim() === '') {
            navigator.clipboard.readText()
                .then(text => {
                    if (isValidTikTokUrl(text)) {
                        elements.urlInput.value = text;
                        showToast('TikTok URL detected in clipboard', 'info');
                    }
                })
                .catch(err => {
                    console.log('Auto clipboard detection unavailable:', err);
                });
        }
    }

    // Service worker registration for offline capabilities
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('/service-worker.js')
                .then(registration => {
                    console.log('ServiceWorker registration successful');
                })
                .catch(error => {
                    console.log('ServiceWorker registration failed:', error);
                });
        });
    }

    // Add analytics event tracking if available
    function trackEvent(category, action, label) {
        if (window.gtag) {
            gtag('event', action, {
                'event_category': category,
                'event_label': label
            });
        }
    }

    // Export public methods for external use
    window.TikTokConverter = {
        convert: convertTikTokToMp3,
        paste: pasteFromClipboard,
        toggleDarkMode: toggleDarkMode
    };
});
</script>
</body>
</html>
