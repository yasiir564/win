<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>TokHaste - Free TikTok to MP3 Converter Online</title>
  
  <!-- SEO Meta Tags -->
  <meta name="description" content="Convert TikTok videos to MP3 instantly with TokHaste. Fast, free, and secure TikTok to MP3 downloader. No registration required!" />
  <meta name="keywords" content="TikTok to MP3, TokHaste, TikTok MP3 converter, download TikTok audio, TikTok downloader, convert TikTok to audio" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/inter-ui/3.19.3/inter.min.css">
    <link rel="icon" href="cHJpdmF0ZS9sci9pbWFnZXMvd2Vic2l0ZS8yMDIyLTA1L3JtNTMzLW5lb24tMDA3LXguanBn [MConverter.eu].ico" type="image/x-icon">
      <link rel="canonical" href="https://tokhaste.com/Tiktok-to-MP3-Converter">

    <style>
        :root {
            --tiktok-black: #000000;
            --tiktok-white: #FFFFFF;
            --tiktok-red: #FE2C55;
            --tiktok-blue: #25F4EE;
            --tiktok-light-gray: #F1F1F2;
            --tiktok-dark-gray: #161823;
            --tiktok-darker-gray: #0f1016;
            --tiktok-gradient: linear-gradient(90deg, var(--tiktok-blue), var(--tiktok-red));
            --card-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            --btn-shadow: 0 7px 14px rgba(254, 44, 85, 0.3);
            --font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            --border-radius: 12px;
            --transition: all 0.3s ease;

            /* For dark mode */
            --bg-primary: var(--tiktok-white);
            --text-primary: var(--tiktok-dark-gray);
            --card-bg: var(--tiktok-white);
            --card-border: rgba(0, 0, 0, 0.1);
        }

        [data-theme="dark"] {
            --bg-primary: var(--tiktok-darker-gray);
            --text-primary: var(--tiktok-white);
            --card-bg: var(--tiktok-dark-gray);
            --card-border: rgba(255, 255, 255, 0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: var(--font-family);
        }
        
        body {
            background-color: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            transition: var(--transition);
            scroll-behavior: smooth;
            overflow-x: hidden;
        }

        .section-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 80px 20px;
}

.section-title {
    font-size: 2.5rem;
    font-weight: 700;
    text-align: center;
    margin-bottom: 3rem;
    position: relative;
}

.highlight {
    background: var(--tiktok-gradient);
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
}

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--bg-primary);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--tiktok-red);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(var(--tiktok-blue), var(--tiktok-red));
        }

        /* Navigation */
        .navbar {
            background-color: var(--bg-primary);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
            transition: var(--transition);
        }
        
        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 2rem;
        }
        
        .logo {
            display: flex;
            align-items: center;
            font-weight: 700;
            font-size: 1.5rem;
            background: var(--tiktok-gradient);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .logo i {
            font-size: 1.8rem;
            margin-right: 0.5rem;
        }
        
        .nav-links {
            display: flex;
            gap: 2rem;
        }
        
        .nav-links a {
            color: var(--text-primary);
            text-decoration: none;
            font-weight: 500;
            transition: var(--transition);
            position: relative;
        }
        
        .nav-links a:hover {
            color: var(--tiktok-red);
        }
        
        .nav-links a.active::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 100%;
            height: 2px;
            background: var(--tiktok-gradient);
        }
        
        .nav-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .theme-toggle, .menu-toggle {
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 1.2rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 50%;
            transition: var(--transition);
        }
        
        .theme-toggle:hover, .menu-toggle:hover {
            background-color: rgba(254, 44, 85, 0.1);
            color: var(--tiktok-red);
        }
        
        .btn-sign-in {
            background: var(--tiktok-gradient);
            color: white;
            border: none;
            padding: 0.5rem 1.2rem;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: var(--btn-shadow);
        }
        
        .btn-sign-in:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(254, 44, 85, 0.4);
        }
        
        .menu-toggle {
            display: none;
        }

        /* Main Content */
        main {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 3rem 1rem;
        }
        
        .container {
            max-width: 700px;
            width: 100%;
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            padding: 2.5rem;
            margin-bottom: 2rem;
            border: 1px solid var(--card-border);
            transition: var(--transition);
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        header {
            text-align: center;
            margin-bottom: 2.5rem;
        }
        
        h1 {
            font-size: 2.2rem;
            margin-bottom: 0.5rem;
            background: var(--tiktok-gradient);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            position: relative;
            display: inline-block;
        }
        
        h1::after {
            content: '';
            position: absolute;
            width: 50%;
            height: 4px;
            background: var(--tiktok-gradient);
            bottom: -10px;
            left: 25%;
            border-radius: 10px;
        }
        
        p.subtitle {
            color: var(--text-primary);
            opacity: 0.7;
            font-size: 1.1rem;
            margin-top: 1rem;
        }
        
        .form-group {
            margin-bottom: 2rem;
            position: relative;
        }
        
        label {
            display: block;
            margin-bottom: 0.8rem;
            font-weight: 500;
            color: var(--text-primary);
        }
        
        .input-wrapper {
            position: relative;
            display: flex;
        }
        
        input[type="text"] {
            width: 100%;
            padding: 1rem 3.5rem 1rem 1.2rem;
            border: 2px solid var(--card-border);
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: var(--transition);
            background-color: var(--bg-primary);
            color: var(--text-primary);
        }
        
        input[type="text"]:focus {
            outline: none;
            border-color: var(--tiktok-red);
            box-shadow: 0 0 0 3px rgba(254, 44, 85, 0.2);
        }
        
        .paste-btn {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--tiktok-red);
            font-size: 1.2rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 50%;
            transition: var(--transition);
        }
        
        .paste-btn:hover {
            background-color: rgba(254, 44, 85, 0.1);
        }
        
        button#convert-btn {
            width: 100%;
            padding: 1rem;
            background: var(--tiktok-gradient);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: var(--btn-shadow);
            position: relative;
            overflow: hidden;
            z-index: 1;
        }
        
        button#convert-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: 0.5s;
            z-index: -1;
        }
        
        button#convert-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(254, 44, 85, 0.4);
        }
        
        button#convert-btn:hover::before {
            left: 100%;
        }
        
        button#convert-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        button#convert-btn:disabled::before {
            display: none;
        }
        
        .progress-container {
            margin-top: 2rem;
            display: none;
        }
        
        .progress-container.visible {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        .progress-text {
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text-primary);
            display: flex;
            justify-content: space-between;
        }
        
        .progress-bar-outer {
            width: 100%;
            height: 10px;
            background-color: var(--tiktok-light-gray);
            border-radius: 10px;
            overflow: hidden;
        }
        
        .progress-bar-inner {
            height: 100%;
            background: var(--tiktok-gradient);
            width: 0%;
            border-radius: 10px;
            transition: width 0.3s ease;
        }
        
        .status {
            margin-top: 1.5rem;
            padding: 1rem;
            border-radius: var(--border-radius);
            display: none;
            animation: fadeIn 0.3s ease;
        }
        
        .status.error {
            background-color: rgba(255, 77, 79, 0.1);
            color: #ff4d4f;
            border: 1px solid #ff4d4f;
            display: block;
        }
        
        .status.success {
            background-color: rgba(82, 196, 26, 0.1);
            color: #52c41a;
            border: 1px solid #52c41a;
            display: block;
        }
        
        .status.loading {
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: rgba(0, 0, 0, 0.05);
            color: var(--text-primary);
        }
        
        .spinner {
            width: 24px;
            height: 24px;
            border: 3px solid rgba(254, 44, 85, 0.3);
            border-radius: 50%;
            border-top-color: var(--tiktok-red);
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
        
        .download-section {
            display: none;
            margin-top: 2rem;
            text-align: center;
            animation: fadeIn 0.5s ease;
        }
        
        .download-section.visible {
            display: block;
        }
        
        .audio-info {
            margin-top: 1rem;
            padding: 1.5rem;
            background-color: var(--bg-primary);
            border-radius: var(--border-radius);
            border: 1px solid var(--card-border);
            text-align: left;
        }
        
        .audio-info p {
            margin-bottom: 0.8rem;
            color: var(--text-primary);
        }

        .audio-info p:last-child {
            margin-bottom: 0;
        }
        
        .audio-info p strong {
            font-weight: 600;
            margin-right: 0.5rem;
            color: var(--tiktok-red);
        }
        
        .download-link {
            display: inline-block;
            background: var(--tiktok-gradient);
            color: white;
            text-decoration: none;
            padding: 1rem 2rem;
            border-radius: var(--border-radius);
            font-weight: 600;
            margin-top: 1.5rem;
            transition: var(--transition);
            box-shadow: var(--btn-shadow);
            cursor: pointer;
        }
        
        .download-link:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(254, 44, 85, 0.4);
        }

        /* Footer */
        .footer {
            background-color: var(--card-bg);
            border-top: 1px solid var(--card-border);
            padding: 3rem 0 1.5rem;
            margin-top: auto;
            transition: var(--transition);
        }
        
        .footer-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }
        
        .footer-top {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 2rem;
            margin-bottom: 2rem;
        }
        
        .footer-logo {
            display: flex;
            align-items: center;
            font-weight: 700;
            font-size: 1.5rem;
            background: var(--tiktok-gradient);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .footer-logo i {
            font-size: 1.8rem;
            margin-right: 0.5rem;
        }
        
        .footer-links {
            display: flex;
            flex-wrap: wrap;
            gap: 3rem;
        }
        
        .footer-column h3 {
            font-size: 1.1rem;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }
        
        .footer-column a {
            display: block;
            color: var(--text-primary);
            opacity: 0.7;
            text-decoration: none;
            margin-bottom: 0.7rem;
            transition: var(--transition);
        }
        
        .footer-column a:hover {
            color: var(--tiktok-red);
            opacity: 1;
        }
        
        .footer-bottom {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 1.5rem;
            border-top: 1px solid var(--card-border);
        }
        
        .footer-bottom p {
            color: var(--text-primary);
            opacity: 0.7;
            font-size: 0.9rem;
        }
        
        .social-links {
            display: flex;
            gap: 1rem;
        }
        
        .social-links a {
            color: var(--text-primary);
            font-size: 1.2rem;
            transition: var(--transition);
        }
        
        .social-links a:hover {
            color: var(--tiktok-red);
            transform: translateY(-3px);
        }

        /* Responsive styles */
        @media (max-width: 768px) {
            .nav-links {
                display: none;
            }
            
            .menu-toggle {
                display: block;
            }
            
            .container {
                padding: 1.5rem;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .footer-top {
                flex-direction: column;
                gap: 2rem;
            }
            
            .footer-links {
                gap: 2rem;
            }
            
            .footer-bottom {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }
        }

        @media (max-width: 480px) {
            .nav-container, .footer-container {
                padding: 1rem;
            }
            
            .btn-sign-in {
                display: none;
            }
            
            .container {
                padding: 1.2rem;
            }
            
            h1 {
                font-size: 1.5rem;
            }
            
            .footer-links {
                flex-direction: column;
                gap: 1.5rem;
            }
        }

        /* Mobile menu */
        .mobile-menu {
            position: fixed;
            top: 0;
            right: -100%;
            width: 70%;
            height: 100vh;
            background-color: var(--card-bg);
            padding: 2rem;
            z-index: 1001;
            transition: right 0.3s ease;
            box-shadow: -5px 0 15px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
        }
        
        .mobile-menu.open {
            right: 0;
        }
        
        .mobile-menu-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }
        
        .mobile-menu-close {
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        .mobile-menu-links {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        
        .mobile-menu-links a {
            color: var(--text-primary);
            text-decoration: none;
            font-weight: 500;
            font-size: 1.2rem;
            transition: var(--transition);
        }
        
        .mobile-menu-links a:hover {
            color: var(--tiktok-red);
        }
        
        .mobile-menu-actions {
            margin-top: 2rem;
        }
        
        .mobile-menu-btn {
            width: 100%;
            padding: 0.8rem;
            background: var(--tiktok-gradient);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            display: none;
            transition: var(--transition);
        }
        
        .overlay.open {
            display: block;
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--card-bg);
            color: var(--text-primary);
            padding: 1rem;
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            transform: translateY(100px);
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
            z-index: 1000;
            max-width: 300px;
        }
        
        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }
        
        .toast-content {
            display: flex;
            align-items: center;
        }
        
        .toast-icon {
            margin-right: 10px;
            font-size: 1.2rem;
        }
        
        .toast-icon.success {
            color: #52c41a;
        }
        
        .toast-icon.error {
            color: #ff4d4f;
        }
        
        .toast-icon.info {
            color: var(--tiktok-blue);
        }
        
        .toast-text {
            flex: 1;
        }
        
        .toast-close {
            background: none;
            border: none;
            color: var(--text-primary);
            opacity: 0.5;
            cursor: pointer;
            font-size: 1rem;
            padding: 0 0 0 10px;
        }
        
        .toast-close:hover {
            opacity: 1;
        }

  /* FAQ Section */
.faq {
    background-color: var(--section-bg);
    padding: 2rem 0;
    transition: var(--transition);
}

.faq-container {
    max-width: 800px;
    margin: 0 auto;
    padding: 0 1rem;
}

.faq-item {
    background-color: var(--faq-bg);
    border-radius: var(--border-radius);
    margin-bottom: 1.25rem;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
    overflow: hidden;
    transition: box-shadow 0.4s ease, transform 0.3s ease;
}

.faq-item:hover {
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
    transform: translateY(-2px);
}

.faq-question {
    padding: 1.5rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
    font-weight: 600;
    font-size: 1.1rem;
    color: var(--text-primary);
    transition: color 0.3s ease, background-color 0.3s ease;
    position: relative;
    z-index: 1;
}

.faq-question:hover {
    color: #ff0050;
}

.faq-question::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 0;
    height: 2px;
    background: var(--tiktok-gradient);
    transition: width 0.3s ease;
    z-index: -1;
}

.faq-question:hover::after {
    width: 100%;
}

.faq-question i {
    transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
    color: var(--text-secondary);
}

.faq-question:hover i {
    color: #00f2ea;
}

.faq-question.active i {
    transform: rotate(180deg);
    color: #00f2ea;
}

.faq-answer {
    padding: 0 1.5rem;
    height: 0;
    overflow: hidden;
    color: var(--text-secondary);
    transition: all 0.5s cubic-bezier(0.25, 0.8, 0.25, 1);
    opacity: 0;
}

.faq-question.active + .faq-answer {
    padding: 0 1.5rem 1.5rem;
    height: auto;
    opacity: 1;
}

/* How to Use Section */
.how-to-use {
    background-color: var(--section-bg);
    position: relative;
    padding: 3rem 0;
    transition: var(--transition);
}

.steps-container {
    display: flex;
    justify-content: center;
    align-items: stretch;
    gap: 2rem;
    flex-wrap: wrap;
    margin-top: 3rem;
}

.step-card {
    background-color: var(--faq-bg);
    border-radius: var(--border-radius);
    box-shadow: var(--card-shadow);
    padding: 2.5rem 2rem;
    text-align: center;
    flex: 1;
    min-width: 250px;
    max-width: 300px;
    transition: transform 0.5s cubic-bezier(0.25, 0.8, 0.25, 1), box-shadow 0.5s ease;
    position: relative;
    overflow: hidden;
}

.step-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 4px;
    background: var(--tiktok-gradient);
    transform: scaleX(0);
    transition: transform 0.5s ease;
    transform-origin: left;
}

.step-card:hover {
    transform: translateY(-12px);
    box-shadow: 0 12px 28px rgba(0, 0, 0, 0.15);
}

.step-card:hover::before {
    transform: scaleX(1);
}

.step-icon {
    width: 80px;
    height: 80px;
    margin: 0 auto 1.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--tiktok-gradient);
    border-radius: 50%;
    color: white;
    font-size: 1.8rem;
    position: relative;
    overflow: hidden;
    transition: transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
}

.step-card:hover .step-icon {
    transform: scale(1.1) rotate(5deg);
}

.step-title {
    font-size: 1.4rem;
    margin-bottom: 1rem;
    font-weight: 600;
    color: var(--text-primary);
    transition: color 0.3s ease;
}

.step-card:hover .step-title {
    color: #ff0050;
}

.step-card p {
    color: var(--text-secondary);
    transition: color 0.3s ease;
}

.step-connector {
    height: 2px;
    width: 60px;
    background: var(--tiktok-gradient);
    flex-shrink: 1;
    position: relative;
    overflow: hidden;
}

.step-connector::after {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.6), transparent);
    animation: shimmer 2s infinite;
}

@keyframes shimmer {
    100% {
        left: 100%;
    }
}

/* Media query for responsive design */
@media (max-width: 768px) {
    .steps-container {
        flex-direction: column;
        align-items: center;
    }
    
    .step-connector {
        width: 2px;
        height: 40px;
    }
}

      /* Progress Bar Enhancement - Keeping as is */
.progress-container {
    display: none;
    flex-direction: column;
    width: 100%;
    margin: 20px 0;
    padding: 20px;
    background: var(--card-bg);
    border-radius: var(--border-radius);
    box-shadow: var(--card-shadow);
    border: 1px solid var(--card-border);
    transition: var(--transition);
}
.progress-container.visible {
    display: flex;
    animation: fadeIn 0.5s ease;
}
.progress-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
}
.progress-status {
    font-weight: 600;
    color: var(--text-primary);
}
.progress-percentage {
    font-weight: 700;
    color: var(--tiktok-red);
}
.progress-bar {
    width: 100%;
    height: 12px;
    background-color: var(--tiktok-light-gray);
    border-radius: 10px;
    overflow: hidden;
    position: relative;
}
.progress-bar-inner {
    height: 100%;
    width: 0;
    background: var(--tiktok-gradient);
    border-radius: 10px;
    transition: width 0.3s ease;
    position: relative;
    overflow: hidden;
}
.progress-bar-inner::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(
        90deg,
        rgba(255, 255, 255, 0) 0%,
        rgba(255, 255, 255, 0.2) 50%,
        rgba(255, 255, 255, 0) 100%
    );
    animation: shimmer 2s infinite;
}
.progress-bar-inner.pulse {
    animation: pulse 0.3s ease;
}
.progress-bar-inner.complete {
    animation: complete 1s ease;
}
.progress-text {
    font-size: 14px;
    margin-top: 10px;
    color: var(--tiktok-dark-gray);
    opacity: 0.7;
    min-height: 20px;
    position: relative;
}
.progress-text.typing::after {
    content: '|';
    animation: blink 1s infinite;
}

/* Audio Player Styles */
.audio-player-container {
    width: 100%;
    margin: 20px 0;
    padding: 10px;
    border-radius: var(--border-radius);
    background: var(--card-bg);
    box-shadow: var(--card-shadow);
    transition: var(--transition);
}

.audio-player-container:hover {
    transform: translateY(-5px);
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
}

.audio-player {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

/* Visualization */
.player-visualization {
    height: 60px;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 10px;
    background: var(--tiktok-dark-gray);
    border-radius: var(--border-radius-sm);
    overflow: hidden;
}

.visualization-bars {
    display: flex;
    align-items: flex-end;
    justify-content: center;
    gap: 5px;
    height: 100%;
    width: 100%;
}

.bar {
    width: 8%;
    height: 5px;
    background: var(--tiktok-gradient);
    border-radius: 2px;
    transition: height 0.2s ease;
}

/* Controls */
.player-controls {
    display: flex;
    align-items: center;
    gap: 15px;
}

.play-pause {
    min-width: 42px;
    height: 42px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--tiktok-red);
    color: white;
    border: none;
    border-radius: 50%;
    cursor: pointer;
    font-size: 16px;
    transition: var(--transition);
    box-shadow: var(--btn-shadow);
}

.play-pause:hover {
    transform: scale(1.1);
    background: var(--tiktok-gradient);
}

.timeline-container {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 5px;
}

.timeline {
    height: 6px;
    background: var(--tiktok-light-gray);
    border-radius: 3px;
    cursor: pointer;
    position: relative;
    overflow: hidden;
}

.progress {
    height: 100%;
    background: var(--tiktok-gradient);
    width: 0;
    border-radius: 3px;
    transition: width 0.1s linear;
}

.time {
    display: flex;
    justify-content: space-between;
    font-size: 12px;
    color: var(--text-color);
}

/* Volume controls */
.volume-container {
    display: flex;
    align-items: center;
    gap: 8px;
}

.volume-btn {
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: transparent;
    color: var(--text-color);
    border: none;
    cursor: pointer;
    font-size: 14px;
    transition: var(--transition);
}

.volume-btn:hover {
    color: var(--tiktok-red);
}

.volume-slider {
    width: 60px;
    height: 4px;
    background: var(--tiktok-light-gray);
    border-radius: 2px;
    cursor: pointer;
    position: relative;
    overflow: hidden;
}

.volume-progress {
    height: 100%;
    background: var(--tiktok-gradient);
    width: 100%;
    border-radius: 2px;
}

/* Responsive styles */
@media (max-width: 768px) {
    .player-controls {
        flex-wrap: wrap;
    }
    
    .volume-container {
        width: 100%;
        margin-top: 10px;
        justify-content: flex-end;
    }
    
    .volume-slider {
        width: 100px;
    }
}

@media (max-width: 480px) {
    .player-visualization {
        height: 50px;
    }
    
    .player-controls {
        gap: 10px;
    }
    
    .play-pause {
        min-width: 36px;
        height: 36px;
        font-size: 14px;
    }
}

/* Enhanced slider thumb and track styling */
.seek-slider::-webkit-slider-thumb,
.volume-slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 14px;
    height: 14px;
    background: var(--tiktok-red);
    border-radius: 50%;
    cursor: pointer;
    transition: all 0.2s ease;
    box-shadow: 0 1px 4px rgba(0, 0, 0, 0.15);
}

.seek-slider::-moz-range-thumb,
.volume-slider::-moz-range-thumb {
    width: 14px;
    height: 14px;
    background: var(--tiktok-red);
    border-radius: 50%;
    cursor: pointer;
    border: none;
    transition: all 0.2s ease;
    box-shadow: 0 1px 4px rgba(0, 0, 0, 0.15);
}

.seek-slider:hover::-webkit-slider-thumb,
.volume-slider:hover::-webkit-slider-thumb {
    transform: scale(1.2);
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
}

.seek-slider:hover::-moz-range-thumb,
.volume-slider:hover::-moz-range-thumb {
    transform: scale(1.2);
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
}

.seek-slider:active::-webkit-slider-thumb,
.volume-slider:active::-webkit-slider-thumb,
.seek-slider:active::-moz-range-thumb,
.volume-slider:active::-moz-range-thumb {
    transform: scale(1.3);
}

.seek-slider:focus,
.volume-slider:focus {
    background: #d5d5d5;
}

/* Enhanced track fill effect */
.seek-slider-fill, 
.volume-slider-fill {
    position: absolute;
    top: 50%;
    left: 0;
    height: 6px;
    background: var(--tiktok-gradient);
    border-radius: 5px;
    z-index: -1;
    transform: translateY(-50%);
    pointer-events: none;
    transition: width 0.1s ease, height 0.2s ease;
}
.seek-slider:hover + .seek-slider-fill {
    height: 8px;
}
.volume-slider:hover + .volume-slider-fill {
    height: 5px;
}

/* Icon styling */
.player-icon {
    width: 20px;
    height: 20px;
    fill: var(--tiktok-white);
    transition: transform 0.2s ease;
}
.player-btn:hover .player-icon {
    transform: scale(1.1);
}

.volume-icon {
    width: 18px;
    height: 18px;
    fill: var(--text-primary);
    cursor: pointer;
    transition: all 0.2s ease;
}
.volume-icon:hover {
    fill: var(--tiktok-red);
    transform: scale(1.1);
}

/* Additional controls */
.secondary-controls {
    display: flex;
    justify-content: flex-end;
    align-items: center;
    margin-top: 12px;
    gap: 16px;
}
.control-btn {
    background: transparent;
    border: none;
    cursor: pointer;
    padding: 6px;
    border-radius: 50%;
    color: var(--text-primary);
    transition: all 0.2s ease;
    opacity: 0.7;
    display: flex;
    align-items: center;
    justify-content: center;
}
.control-btn:hover {
    opacity: 1;
    background: rgba(0, 0, 0, 0.05);
    transform: translateY(-1px);
}
.control-btn.active {
    color: var(--tiktok-red);
    opacity: 1;
}
.control-icon {
    width: 16px;
    height: 16px;
}

/* Enhanced Animation keyframes */
@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes slideUp {
    from { 
        opacity: 0;
        transform: translateY(20px);
    }
    to { 
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes shimmer {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
}

@keyframes enhancedPulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.12); }
    100% { transform: scale(1); }
}

@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
}

@keyframes complete {
    0% { background: var(--tiktok-gradient); }
    50% { background: var(--tiktok-green); }
    100% { background: var(--tiktok-gradient); }
}

@keyframes blink {
    0%, 100% { opacity: 1; }
    50% { opacity: 0; }
}

@keyframes waveform {
    0% { height: 3px; }
    50% { height: 12px; }
    100% { height: 3px; }
}

/* Playing state animations */
.audio-player.playing .waveform span {
    animation: waveform 0.5s ease infinite;
    animation-delay: calc(var(--i) * 0.05s);
}

.waveform {
    display: none;
    gap: 3px;
    height: 15px;
    align-items: center;
}
.audio-player.playing .waveform {
    display: flex;
}
.waveform span {
    display: inline-block;
    width: 3px;
    height: 3px;
    background: var(--tiktok-red);
    border-radius: 1px;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .volume-controls {
        width: 120px;
    }
    
    .player-btn {
        width: 44px;
        height: 44px;
    }
    
    .time {
        min-width: 40px;
        font-size: 13px;
    }
    
    .secondary-controls {
        gap: 12px;
    }
}

@media (max-width: 480px) {
    .audio-controls {
        flex-wrap: wrap;
    }
    
    .volume-controls {
        width: 100%;
        margin-top: 12px;
    }
    
    .time-slider {
        width: 100%;
    }
    
    .audio-player {
        padding: 20px;
    }
    
    .secondary-controls {
        margin-top: 16px;
        justify-content: space-between;
    }
}
    </style>
</head>
<body>
<!-- Navigation -->
<nav class="navbar">
    <div class="nav-container">
        <div class="logo">
            <i class="fab fa-tiktok"></i>
            <span>TokHaste</span>
        </div>
        
        <div class="nav-links">
            <a href="Tiktok-downloader.html" class="active">Tiktok Downloader</a>
            <a href="Tiktok-to-MP3-Converter.html">TikTok to MP3 Converter</a>
            <a href="Video-to-Audio-Converter.html">MP4 To Mp3 FREE</a>
        </div>
        
        <div class="nav-actions">
            <button class="theme-toggle" id="darkModeToggle" aria-label="Toggle dark mode">
                <i class="fas fa-moon"></i>
            </button>
            <button class="btn-sign-in">Sign In</button>
            <button class="menu-toggle" id="mobileMenuToggle" aria-label="Toggle menu">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </div>
</nav>

<!-- Mobile Menu -->
<div class="mobile-menu" id="mobileMenu">
    <div class="mobile-menu-header">
        <div class="logo">
            <i class="fab fa-tiktok"></i>
            <span>TokHaste</span>
        </div>
        <button class="mobile-menu-close" id="mobileMenuClose">
            <i class="fas fa-times"></i>
        </button>
    </div>
    <div class="mobile-menu-links">
        <a href="Tiktok-downloader.html" class="active">Tiktok Downloader</a>
        <a href="Tiktok-to-MP3-Converter.html">TikTok to MP3 Converter</a>
        <a href="Video-to-Audio-Converter.html">MP4 To Mp3 FREE</a>
    </div>
    <div class="mobile-menu-actions">
        <button class="mobile-menu-btn">Sign In</button>
    </div>
</div>
<div class="overlay" id="overlay"></div>

<!-- Toast Notification -->
<div class="toast" id="toast">
    <div class="toast-content">
        <div class="toast-icon success" id="toastIcon">
            <i class="fas fa-check-circle"></i>
        </div>
        <div class="toast-text" id="toastText">
            Operation successful!
        </div>
        <button class="toast-close" id="toastClose">
            <i class="fas fa-times"></i>
        </button>
    </div>
</div>

<!-- Main Content -->
<main>
    <div class="container">
        <header>
            <h1>TikTok to MP3 Converter</h1>
            <p class="subtitle">Extract high-quality audio from TikTok videos in seconds</p>
        </header>
        
        <div class="form-group">
            <label for="tiktok-url">Paste TikTok Video URL</label>
            <div class="input-wrapper">
                <input type="text" id="tiktok-url" placeholder="https://www.tiktok.com/@username/video/1234567890" autocomplete="off">
                <button id="paste-btn" class="paste-btn" title="Paste from clipboard">
                    <i class="fas fa-paste"></i>
                </button>
            </div>
        </div>
        
        <!-- Turnstile Container (Added based on JS) -->
        <div id="turnstileContainer"></div>
        
        <button id="convert-btn">Convert to MP3</button>
        
        <div id="progress-container" class="progress-container">
            <div class="progress-header">
                <div id="progress-status" class="progress-status">Initializing...</div>
                <div id="progress-percentage" class="progress-percentage">0%</div>
            </div>
            <div class="progress-bar">
                <div id="progress-bar-inner" class="progress-bar-inner"></div>
            </div>
            <div id="progress-text" class="progress-text">Getting ready</div>
            <!-- Added progress time element referenced in JS -->
            <div id="progress-time" class="progress-time">00:00</div>
        </div>
        
        <div id="status" class="status"></div>
        
        <!-- Error Container (Added based on JS) -->
        <div id="errorContainer" class="error-container" style="display: none;">
            <div class="error-icon"><i class="fas fa-exclamation-circle"></i></div>
            <div id="errorMessage" class="error-message">An error occurred</div>
            <button id="tryAgainBtn" class="try-again-btn">Try Again</button>
        </div>
        
        <!-- Updated Audio Player Container with Visualization - Now Hidden by Default -->
        <div id="audio-player-container" class="audio-player-container" style="display: none;">
            <div class="audio-player">
                <div class="player-visualization">
                    <div class="visualization-bars">
                        <div class="bar"></div>
                        <div class="bar"></div>
                        <div class="bar"></div>
                        <div class="bar"></div>
                        <div class="bar"></div>
                        <div class="bar"></div>
                        <div class="bar"></div>
                        <div class="bar"></div>
                        <div class="bar"></div>
                        <div class="bar"></div>
                    </div>
                </div>
                <div class="player-controls">
                    <button class="play-pause" id="play-pause-btn">
                        <i class="fas fa-play"></i>
                    </button>
                    <div class="timeline-container">
                        <div class="timeline" id="seek-slider">
                            <div class="progress"></div>
                        </div>
                        <div class="time">
                            <span class="current" id="current-time">0:00</span>
                            <span class="duration" id="duration-time">0:00</span>
                        </div>
                    </div>
                    <div class="volume-container">
                        <button class="volume-btn" id="volume-btn">
                            <i class="fas fa-volume-up"></i>
                        </button>
                        <div class="volume-slider" id="volume-control">
                            <div class="volume-progress"></div>
                        </div>
                    </div>
                </div>
                <audio id="audio-element"></audio>
            </div>
        </div>
        
        <div id="download-section" class="download-section">
            <div class="audio-info">
                <!-- Audio info paragraphs removed as requested -->
            </div>
            <a id="download-link" class="download-link" href="#" download>
                <i class="fas fa-download"></i> Download MP3
            </a>
        </div>
        
        <!-- Debug Info Container (Added based on JS references) -->
        <div id="debugInfo" style="display: none;" class="debug-info"></div>
    </div>
</main>

<!-- Required Scripts -->
<script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async></script>

    <!-- How to Use Section -->
<section class="how-to-use">
    <div class="section-container">
        <h2 class="section-title">How to Use <span class="highlight">TokHaste</span> TikTok MP3 Converter</h2>
        
        <div class="steps-container">
            <div class="step-card">
                <div class="step-icon">
                    <i class="fas fa-link"></i>
                </div>
                <h3 class="step-title">Copy Link</h3>
                <p>Copy the TikTok video link from the app or website</p>
            </div>
            
            <div class="step-connector"></div>
            
            <div class="step-card">
                <div class="step-icon">
                    <i class="fas fa-paste"></i>
                </div>
                <h3 class="step-title">Paste URL</h3>
                <p>Paste the link in the input field above</p>
            </div>
            
            <div class="step-connector"></div>
            
            <div class="step-card">
                <div class="step-icon">
                    <i class="fas fa-download"></i>
                </div>
                <h3 class="step-title">Download</h3>
                <p>Click the download button and save your audio in MP3 format</p>
            </div>
        </div>
    </div>
</section>

<!-- FAQ Section -->
<section class="faq" id="faq">
    <div class="section-container">
        <h2 class="section-title">Frequently Asked Questions</h2>
        
        <div class="faq-container">
            <!-- FAQ Item -->
            <div class="faq-item">
                <div class="faq-question" tabindex="0">
                    <span>Is this TikTok MP3 downloader free to use?</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="faq-answer">
                    <p>Yes, our <a href="https://tokhaste.com/Tiktok-to-MP3-Converter" title="Free TikTok MP3 Downloader">TikTok MP3 downloader</a> is 100% free to use with no hidden charges or subscription fees.</p>
                </div>
            </div>

            <!-- FAQ Item -->
            <div class="faq-item">
                <div class="faq-question" tabindex="0">
                    <span>How long does it take to download TikTok audio?</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="faq-answer">
                    <p>Our tool processes and downloads TikTok audio in seconds, providing you with fast MP3 extraction.</p>
                </div>
            </div>

            <!-- FAQ Item -->
            <div class="faq-item">
                <div class="faq-question" tabindex="0">
                    <span>Is there a limit to how many audio files I can download?</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="faq-answer">
                    <p>There is no daily limit. However, we encourage fair usage to keep the service fast and free for all users.</p>
                </div>
            </div>

            <!-- FAQ Item -->
            <div class="faq-item">
                <div class="faq-question" tabindex="0">
                    <span>Which devices are supported?</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="faq-answer">
                    <p>You can use our MP3 downloader on all devices including <strong>Android, iOS, Windows, and Mac</strong> without any installations.</p>
                </div>
            </div>

            <!-- New FAQ Items for MP3 Downloader -->
            <div class="faq-item">
                <div class="faq-question" tabindex="0">
                    <span>Do I need to log in or sign up?</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="faq-answer">
                    <p>No login or registration is required. Just paste the video link and start downloading MP3 audio instantly.</p>
                </div>
            </div>

            <div class="faq-item">
                <div class="faq-question" tabindex="0">
                    <span>Is this TikTok MP3 downloader safe?</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="faq-answer">
                    <p>Yes, our platform is secure and respects your privacy. We do not store or track any user data. Read more on our <a href="https://tokhaste.com/privacypolicy" title="Privacy Policy">Privacy Policy</a> page.</p>
                </div>
            </div>

            <div class="faq-item">
                <div class="faq-question" tabindex="0">
                    <span>What is the quality of the downloaded MP3 files?</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="faq-answer">
                    <p>We extract audio at the highest quality available from the original TikTok video to provide you with the best MP3 experience — or you can use our <a href="https://tokhaste.com/Video-to-Audio-Converter" target="_blank">free Video to Audio converter</a> for quick and easy conversions.</p>
                </div>
            </div>

            <div class="faq-item">
                <div class="faq-question" tabindex="0">
                    <span>How do I download TikTok audio using this tool?</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="faq-answer">
                    <p>It's easy! Copy the TikTok video URL, paste it into our <a href="https://tokhaste.com/Tiktok-to-MP3-Converter" title="Online TikTok MP3 Downloader">TikTok MP3 downloader tool</a>, and click "Download".</p>
                </div>
            </div>

            <div class="faq-item">
                <div class="faq-question" tabindex="0">
                    <span>Can I use this tool on iPhone or iPad?</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="faq-answer">
                    <p>Yes, our MP3 downloader works seamlessly on iPhone and iPad. For best results, use Safari or Chrome browser.</p>
                </div>
            </div>

            <div class="faq-item">
                <div class="faq-question" tabindex="0">
                    <span>Can I download TikTok videos as well?</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="faq-answer">
                    <p>Yes, TokHaste also offers a <a href="https://tokhaste.com/" title="TikTok Video Downloader">TikTok video downloader</a> if you prefer to save the entire video instead of just the audio.</p>
                </div>
            </div>
        </div>
    </div>
</section>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-container">
            <div class="footer-top">
                <div class="footer-logo">
                    <i class="fab fa-tiktok"></i>
                    <span>TokHaste</span>
                </div>
                <div class="footer-links">
                    <div class="footer-column">
                        <h3>Pages</h3>
                        <a href="Tiktok-downloader.html">Home</a>
                        <a href="privacypolicy.html">Privacy Policy</a>
                    </div>
                    <div class="footer-column">
                        <h3>Our Tools</h3>
                        <a href="Tiktok-downloader.html">Tiktok Downloader</a>
                        <a href="Tiktok-to-MP3-Converter.html">Tiktok To Mp3</a>
                        <a href="Video-to-Audio-Converter.html">Video To Mp3</a>
                    </div>
                    <div class="footer-column">
                        <h3>Legal</h3>
                        <a href="Terms of services.html">Terms of Service</a>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 TokHaste. All rights reserved.</p>
                <div class="social-links">
                    <a href="#" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                    <a href="#" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
                    <a href="#" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                </div>
            </div>
        </div>
    </footer>


    <script>
    document.addEventListener('DOMContentLoaded', function() {
    // Constants
    const API_URL = 'https://mainpy-v09m.onrender.com/api/convert';
    const TOAST_DURATION = 5000;
    const TURNSTILE_SITE_KEY = '0x4AAAAAABHoxdccCZ_9Cezk'; // Replace with your actual site key
    
    // Conversion stages with improved messaging from second file
    const CONVERSION_STAGES = [
        { threshold: 5, message: 'Initializing download process...', subtext: 'Getting ready' },
        { threshold: 15, message: 'Connecting to our servers...', subtext: 'Establishing secure connection' },
        { threshold: 25, message: 'Fetching TikTok video information...', subtext: 'Retrieving metadata' },
        { threshold: 40, message: 'Retrieving audio stream...', subtext: 'Finding the best quality' },
        { threshold: 55, message: 'Extracting audio content...', subtext: 'Isolating the sound' },
        { threshold: 70, message: 'Processing audio file...', subtext: 'Almost there' },
        { threshold: 85, message: 'Optimizing audio quality...', subtext: 'Making it sound great' },
        { threshold: 95, message: 'Preparing download...', subtext: 'Final touches' }
    ];

    // Cache DOM elements - combining elements from both files
    const elements = {
        // From first file - TikTok URL input elements
        urlInput: document.getElementById('tiktok-url'),
        pasteBtn: document.getElementById('paste-btn'),
        convertBtn: document.getElementById('convert-btn'),
        statusDiv: document.getElementById('status'),
        
        // Progress elements - enhanced with second file styling
        progressContainer: document.getElementById('progress-container'),
        progressStatus: document.getElementById('progress-status'),
        progressPercentage: document.getElementById('progress-percentage'),
        progressBarInner: document.getElementById('progress-bar-inner'),
        progressText: document.getElementById('progress-text'),
        progressTime: document.getElementById('progress-time'),
        
        // Download section - enhanced with second file styling
        downloadSection: document.getElementById('download-section'),
        downloadLink: document.getElementById('download-link'),
        audioTitleEl: document.getElementById('audio-title'),
        audioAuthorEl: document.getElementById('audio-author'),
        audioDurationEl: document.getElementById('audio-duration'),
        
        // UI elements from second file
        darkModeToggle: document.getElementById('darkModeToggle'),
        body: document.body,
        mobileMenuToggle: document.getElementById('mobileMenuToggle'),
        mobileMenu: document.getElementById('mobileMenu'),
        mobileMenuClose: document.getElementById('mobileMenuClose'),
        overlay: document.getElementById('overlay'),
        
        // Toast notification elements - improved from second file
        toast: document.getElementById('toast'),
        toastText: document.getElementById('toastText'),
        toastIcon: document.getElementById('toastIcon'),
        toastTitle: document.getElementById('toastTitle'),
        toastMessage: document.getElementById('toastMessage'),
        toastClose: document.getElementById('toastClose'),
        
        // Audio player elements - improved with visualization from second file
        audioPlayer: document.getElementById('audio-player-container'),
        audioElement: document.getElementById('audio-element'),
        playPauseBtn: document.getElementById('play-pause-btn'),
        seekSlider: document.getElementById('seek-slider'),
        currentTimeEl: document.getElementById('current-time'),
        durationEl: document.getElementById('duration-time'),
        volumeControl: document.getElementById('volume-control'),
        volumeBtn: document.getElementById('volume-btn'),
        
        // Error elements from second file
        errorContainer: document.getElementById('errorContainer'),
        errorMessage: document.getElementById('errorMessage'),
        tryAgainBtn: document.getElementById('tryAgainBtn')
    };

    // State variables
    let conversionStartTime = null;
    let progressTimer = null;
    let conversionPhase = 'idle';
    let conversionInProgress = false;
    let turnstileWidget = null;
    let turnstileToken = null;
    let convertedFileName = null;

    // Initialize
    initDarkMode();
    initEventListeners();
    detectClipboardUrl();
    initTurnstile();

    // Initialize dark mode
    function initDarkMode() {
        const isDarkMode = localStorage.getItem('darkMode') === 'true';
        if (isDarkMode) {
            elements.body.setAttribute('data-theme', 'dark');
            elements.darkModeToggle.innerHTML = '<i class="fas fa-sun"></i>';
        } else {
            elements.darkModeToggle.innerHTML = '<i class="fas fa-moon"></i>';
        }
    }

    // Initialize Cloudflare Turnstile (from second file)
    function initTurnstile() {
        // Create a container for Turnstile widget if it doesn't exist
        let turnstileContainer = document.getElementById('turnstileContainer');
        if (!turnstileContainer) {
            turnstileContainer = document.createElement('div');
            turnstileContainer.id = 'turnstileContainer';
            // Insert before the convert button
            elements.convertBtn.parentNode.insertBefore(turnstileContainer, elements.convertBtn);
        }

        // Render the Turnstile widget
        if (window.turnstile) {
            turnstileWidget = window.turnstile.render('#turnstileContainer', {
                sitekey: TURNSTILE_SITE_KEY,
                callback: function(token) {
                    turnstileToken = token;
                    logDebug('Turnstile token received');
                    // Enable the convert button when token is received
                    elements.convertBtn.disabled = false;
                },
                'expired-callback': function() {
                    turnstileToken = null;
                    logDebug('Turnstile token expired');
                    // Disable convert button if token expires
                    elements.convertBtn.disabled = true;
                }
            });
        } else {
            logDebug('Turnstile not loaded. Loading script...');
            // Load Turnstile script if not already loaded
            const script = document.createElement('script');
            script.src = 'https://challenges.cloudflare.com/turnstile/v0/api.js';
            script.async = true;
            script.onload = () => {
                logDebug('Turnstile script loaded');
                initTurnstile();
            };
            document.head.appendChild(script);
        }
    }

    // Reset Turnstile widget
    function resetTurnstile() {
        if (window.turnstile && turnstileWidget) {
            window.turnstile.reset(turnstileWidget);
            turnstileToken = null;
            logDebug('Turnstile widget reset');
        }
    }

    // Set up all event listeners
    function initEventListeners() {
        // Dark mode toggle from second file
        elements.darkModeToggle.addEventListener('click', toggleDarkMode);

        // Mobile menu from second file
        if (elements.mobileMenuToggle) {
            elements.mobileMenuToggle.addEventListener('click', openMobileMenu);
            elements.mobileMenuClose.addEventListener('click', closeMobileMenu);
            elements.overlay.addEventListener('click', closeMobileMenu);
        }

        // Toast from second file
        if (elements.toastClose) {
            elements.toastClose.addEventListener('click', hideToast);
        }

        // Paste button from first file
        elements.pasteBtn.addEventListener('click', pasteFromClipboard);

        // Convert button
        elements.convertBtn.addEventListener('click', convertTikTokToMp3);

        // Enter key to submit
        elements.urlInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !elements.convertBtn.disabled) {
                elements.convertBtn.click();
            }
        });

        // Try again button (from second file)
        if (elements.tryAgainBtn) {
            elements.tryAgainBtn.addEventListener('click', function() {
                hideError();
                resetConverter();
                resetTurnstile();
            });
        }

        // FAQ Accordion Functionality (from both files)
        const faqQuestions = document.querySelectorAll('.faq-question');
        faqQuestions.forEach(question => {
            question.addEventListener('click', () => {
                question.classList.toggle('active');
                const answer = question.nextElementSibling;
                
                if (answer.style.maxHeight) {
                    answer.style.maxHeight = null;
                } else {
                    answer.style.maxHeight = answer.scrollHeight + 'px';
                }
                
                const chevron = question.querySelector('.fa-chevron-down');
                if (chevron) {
                    chevron.classList.toggle('rotate');
                }
            });

            // Add keyboard support
            question.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    question.click();
                }
            });
        });

        // Sign In Button Functionality (from both files)
        const signInButton = document.querySelector('.btn-sign-in');
        if (signInButton) {
            signInButton.addEventListener('click', () => {
                window.location.href = 'login.html';
            });
        }
    }

    // Smooth scroll function (from second file)
    function smoothScrollTo(element) {
        if (!element) return;
        
        const y = element.getBoundingClientRect().top + window.pageYOffset - 20;
        window.scrollTo({
            top: y,
            behavior: 'smooth'
        });
    }

    // Dark mode toggle function (from second file)
    function toggleDarkMode() {
        const isDarkMode = elements.body.getAttribute('data-theme') === 'dark';
        
        if (isDarkMode) {
            elements.body.removeAttribute('data-theme');
            elements.darkModeToggle.innerHTML = '<i class="fas fa-moon"></i>';
            localStorage.setItem('darkMode', 'false');
        } else {
            elements.body.setAttribute('data-theme', 'dark');
            elements.darkModeToggle.innerHTML = '<i class="fas fa-sun"></i>';
            localStorage.setItem('darkMode', 'true');
        }
    }

    // Mobile menu functions (from second file)
    function openMobileMenu() {
        elements.mobileMenu.classList.add('open');
        elements.overlay.classList.add('open');
        document.body.style.overflow = 'hidden';
    }

    function closeMobileMenu() {
        elements.mobileMenu.classList.remove('open');
        elements.overlay.classList.remove('open');
        document.body.style.overflow = '';
    }

    // Toast notification function (enhanced from second file)
    function showToast(title, message, type = 'success') {
        const iconMap = {
            success: 'fa-check-circle',
            error: 'fa-exclamation-circle',
            info: 'fa-info-circle',
            warning: 'fa-exclamation-triangle'
        };
        
        // Set toast content
        elements.toastIcon.className = 'toast-icon ' + type;
        elements.toastIcon.innerHTML = `<i class="fas ${iconMap[type] || iconMap.success}"></i>`;
        
        if (elements.toastTitle) {
            elements.toastTitle.textContent = title;
        }
        
        if (elements.toastMessage) {
            elements.toastMessage.textContent = message;
        } else if (elements.toastText) {
            elements.toastText.textContent = message;
        }
        
        // Show toast
        elements.toast.classList.add('show');
        
        // Clear any existing timeout
        if (window.toastTimeout) {
            clearTimeout(window.toastTimeout);
        }
        
        // Set new timeout
        window.toastTimeout = setTimeout(hideToast, TOAST_DURATION);
    }

    function hideToast() {
        elements.toast.classList.remove('show');
    }

    // Paste functionality from first file
    async function pasteFromClipboard() {
        try {
            const text = await navigator.clipboard.readText();
            elements.urlInput.value = text;
            
            if (isValidTikTokUrl(text)) {
                showToast('URL Pasted', 'TikTok URL pasted from clipboard', 'info');
            } else {
                showToast('Invalid URL', 'URL pasted, but it doesn\'t appear to be a valid TikTok URL', 'warning');
            }
        } catch (err) {
            console.error('Clipboard error:', err);
            showToast('Clipboard Error', 'Failed to read clipboard. Please paste manually.', 'error');
        }
    }

    // Check for TikTok URL in clipboard on load (from first file)
    async function detectClipboardUrl() {
        try {
            // Check if clipboard API is available
            if (navigator.clipboard && navigator.clipboard.readText) {
                const clipboardText = await navigator.clipboard.readText();
                if (isValidTikTokUrl(clipboardText) && elements.urlInput.value === '') {
                    elements.urlInput.value = clipboardText;
                    showToast('URL Detected', 'TikTok URL detected in clipboard', 'info');
                }
            }
        } catch (err) {
            // Silently ignore clipboard errors on load
            console.log('Clipboard access denied or not available');
        }
    }

    // URL validation (enhanced from first file)
    function isValidTikTokUrl(url) {
        // Enhanced regex to support more TikTok URL formats
        const regex = /^(https?:\/\/)?(www\.|vm\.)?(tiktok\.com)(\/(@[\w.-]+\/video\/\d+|\w+\/\w+\/\w+|v\/\w+|[A-Za-z0-9]+))/;
        return regex.test(url);
    }

    // Reset UI elements before conversion
    function resetUI() {
        elements.progressContainer.classList.remove('visible');
        elements.statusDiv.style.display = 'none';
        elements.downloadSection.classList.remove('visible');
        elements.audioPlayer.classList.remove('visible');
        
        // Reset audio player
        if (elements.audioElement) {
            elements.audioElement.pause();
            elements.audioElement.src = '';
            elements.playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
        }
        
        // Reset progress elements
        if (elements.progressBarInner) {
            elements.progressBarInner.style.width = '0%';
        }
        if (elements.progressPercentage) {
            elements.progressPercentage.textContent = '0%';
        }
        if (elements.progressTime) {
            elements.progressTime.textContent = '00:00';
        }
        
        // Hide error container if exists
        if (elements.errorContainer) {
            elements.errorContainer.style.display = 'none';
        }
    }

    // Reset converter to initial state (from second file)
    function resetConverter() {
        convertedFileName = null;
        resetUI();
        elements.convertBtn.disabled = !turnstileToken;
        elements.convertBtn.textContent = 'Convert Now';
        elements.convertBtn.classList.remove('processing');
        conversionPhase = 'idle';
        conversionInProgress = false;
        
        // Remove audio player with visualization if it exists
        const audioPlayerContainer = document.querySelector('.audio-player-container');
        if (audioPlayerContainer) {
            audioPlayerContainer.remove();
        }
        
        if (progressTimer) {
            clearInterval(progressTimer);
            progressTimer = null;
        }
        
        logDebug('Converter reset to initial state');
    }

    // Update progress animation with more detailed stages (combined from both files)
    function startProgressAnimation() {
        let progress = 0;
        let currentStageIndex = 0;
        
        return setInterval(() => {
            if (progress < 95) {
                // Calculate a random increment between 0.5 and 2
                const increment = 0.5 + Math.random() * 1.5;
                progress += increment;
                
                // Check if we need to update the stage message
                while (currentStageIndex < CONVERSION_STAGES.length && 
                      progress >= CONVERSION_STAGES[currentStageIndex].threshold) {
                    elements.progressStatus.textContent = CONVERSION_STAGES[currentStageIndex].message;
                    
                    // Update subtext with typing animation
                    updateProgressSubtext(CONVERSION_STAGES[currentStageIndex].subtext);
                    
                    currentStageIndex++;
                }
                
                // Update progress bar and percentage
                elements.progressBarInner.style.width = `${progress}%`;
                elements.progressPercentage.textContent = `${Math.round(progress)}%`;
                
                // Update elapsed time if the element exists
                if (elements.progressTime) {
                    updateElapsedTime();
                }
                
                // Add pulsing animation for visual feedback
                if (progress % 10 < 0.5) {
                    elements.progressBarInner.classList.add('pulse');
                    setTimeout(() => {
                        elements.progressBarInner.classList.remove('pulse');
                    }, 300);
                }
            }
        }, 350);
    }
    
    // Update elapsed time (from second file)
    function updateElapsedTime() {
        if (!conversionStartTime || !elements.progressTime) return;
        
        const elapsedSeconds = Math.floor((Date.now() - conversionStartTime) / 1000);
        const minutes = Math.floor(elapsedSeconds / 60);
        const seconds = elapsedSeconds % 60;
        
        elements.progressTime.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    }
    
    // Typing animation for progress subtext (from first file)
    function updateProgressSubtext(text) {
        if (!elements.progressText) return;
        
        elements.progressText.textContent = '';
        elements.progressText.classList.add('typing');
        
        let i = 0;
        const typingInterval = setInterval(() => {
            if (i < text.length) {
                elements.progressText.textContent += text.charAt(i);
                i++;
            } else {
                clearInterval(typingInterval);
                setTimeout(() => {
                    elements.progressText.classList.remove('typing');
                }, 500);
            }
        }, 50);
    }

    // Format duration in seconds to MM:SS
    function formatDuration(seconds) {
        if (!seconds || isNaN(seconds)) return 'Unknown';
        
        seconds = Math.round(parseFloat(seconds));
        const minutes = Math.floor(seconds / 60);
        const remainingSeconds = seconds % 60;
        return `${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;
    }

    // Helper function to extract filename from the Content-Disposition header
    function getFilenameFromResponse(response) {
        const contentDisposition = response.headers.get('Content-Disposition');
        if (!contentDisposition) return null;
        
        const matches = /filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/.exec(contentDisposition);
        if (matches && matches[1]) {
            return matches[1].replace(/['"]/g, '');
        }
        return null;
    }

    // Handle specific error types (enhanced from second file)
    function handleError(error, response) {
        let errorMessage = 'Failed to convert TikTok to MP3. Please try again.';
        
        // Check if it's a network error
        if (!navigator.onLine) {
            errorMessage = 'No internet connection. Please check your network and try again.';
        }
        // Check if it's a server error
        else if (response && response.status >= 500) {
            errorMessage = 'Server error. Our service is experiencing issues. Please try again later.';
        }
        // Check if it's a rate limit error
        else if (response && response.status === 429) {
            errorMessage = 'Too many requests. Please wait a moment and try again.';
        }
        // Check if TikTok video is not found or private
        else if (response && response.status === 404) {
            errorMessage = 'Video not found. The TikTok may be private or deleted.';
        }
        // Check if it's a bad request
        else if (response && response.status === 400) {
            errorMessage = 'Invalid request. Please check the TikTok URL format.';
        }
        // If we have an error message from the server, use it
        else if (error.message) {
            errorMessage = error.message;
        }
        
        return errorMessage;
    }

    // Show error message (from second file)
    function showError(message) {
        if (elements.errorContainer) {
            elements.errorContainer.style.display = 'block';
            elements.errorMessage.textContent = message;
            elements.progressContainer.classList.remove('visible');
            logDebug(`Error shown to user: ${message}`);
            showToast('Error', message, 'error');
            
            // Scroll to error container
            smoothScrollTo(elements.errorContainer);
        } else {
            // Fallback to status div if no error container
            elements.statusDiv.textContent = `Error: ${message}`;
            elements.statusDiv.className = 'status error';
            elements.statusDiv.style.display = 'block';
            elements.progressContainer.classList.remove('visible');
            
            showToast('Error', message, 'error');
        }
    }

    // Hide error message
    function hideError() {
        if (elements.errorContainer) {
            elements.errorContainer.style.display = 'none';
        }
        if (elements.statusDiv) {
            elements.statusDiv.style.display = 'none';
        }
    }

    // Log debug information (from second file)
    function logDebug(message) {
        const timestamp = new Date().toLocaleTimeString();
        const logMessage = `[${timestamp}] ${message}`;
        console.log(logMessage);
        
        // For development troubleshooting
        const debugInfo = document.getElementById('debugInfo');
        if (debugInfo && debugInfo.style.display === 'block') {
            debugInfo.innerHTML += logMessage + '<br>';
        }
    }

    // Create enhanced audio player with visualization (from second file)
    function createAudioPlayer() {
        const audioPlayerHTML = `
            <div class="audio-player-container">
                <div class="audio-player">
                    <div class="player-visualization">
                        <div class="visualization-bars">
                            <div class="bar"></div>
                            <div class="bar"></div>
                            <div class="bar"></div>
                            <div class="bar"></div>
                            <div class="bar"></div>
                            <div class="bar"></div>
                            <div class="bar"></div>
                            <div class="bar"></div>
                            <div class="bar"></div>
                            <div class="bar"></div>
                        </div>
                    </div>
                    <div class="player-controls">
                        <button class="play-pause" id="play-pause-btn">
                            <i class="fas fa-play"></i>
                        </button>
                        <div class="timeline-container">
                            <div class="timeline" id="seek-slider">
                                <div class="progress"></div>
                            </div>
                            <div class="time">
                                <span class="current" id="current-time">0:00</span>
                                <span class="duration" id="duration-time">0:00</span>
                            </div>
                        </div>
                        <div class="volume-container">
                            <button class="volume-btn" id="volume-btn">
                                <i class="fas fa-volume-up"></i>
                            </button>
                            <div class="volume-slider" id="volume-control">
                                <div class="volume-progress"></div>
                            </div>
                        </div>
                    </div>
                    <audio id="audio-element"></audio>
                </div>
            </div>
        `;
        
        return audioPlayerHTML;
    }

    // Initialize audio player with visualization (from second file)
    function initAudioPlayer() {
        const audioElement = document.getElementById('audio-element');
        const playPauseBtn = document.getElementById('play-pause-btn');
        const timeline = document.getElementById('seek-slider');
        const progress = document.querySelector('.progress');
        const currentTime = document.getElementById('current-time');
        const duration = document.getElementById('duration-time');
        const volumeBtn = document.getElementById('volume-btn');
        const volumeSlider = document.getElementById('volume-control');
        const volumeProgress = document.querySelector('.volume-progress');
        const visualizationBars = document.querySelectorAll('.bar');
        
        let isPlaying = false;
        let animationFrameId;
        
        // Set audio source
        if (convertedFileName) {
            // If we have a direct URL to the MP3
            audioElement.src = elements.downloadLink.href;
        }
        
        // Auto play when loaded
        audioElement.addEventListener('canplaythrough', () => {
            // Update duration display
            const audioDuration = formatTime(audioElement.duration);
            duration.textContent = audioDuration;
            
            // Start playing automatically if permitted by browser
            audioElement.play().then(() => {
                playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
                isPlaying = true;
                animateVisualizationBars();
            }).catch(error => {
                // Auto-play prevented by browser
                console.log('Auto-play prevented by browser:', error);
                playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
                isPlaying = false;
            });
        });
        
        // Play/Pause toggle
        playPauseBtn.addEventListener('click', () => {
            if (isPlaying) {
                audioElement.pause();
                playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
                isPlaying = false;
                
                // Stop visualization animation
                if (animationFrameId) {
                    cancelAnimationFrame(animationFrameId);
                }
            } else {
                audioElement.play();
                playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
                isPlaying = true;
                
                // Start visualization animation
                animateVisualizationBars();
            }
        });
        
        // Timeline click
        timeline.addEventListener('click', (e) => {
            const timelineWidth = timeline.clientWidth;
            const clickPosition = e.offsetX;
            const clickPercentage = clickPosition / timelineWidth;
            const seekTime = clickPercentage * audioElement.duration;
            
            audioElement.currentTime = seekTime;
        });
        
        // Volume button click
        volumeBtn.addEventListener('click', () => {
            if (audioElement.muted) {
                audioElement.muted = false;
                volumeBtn.innerHTML = '<i class="fas fa-volume-up"></i>';
                volumeProgress.style.width = (audioElement.volume * 100) + '%';
            } else {
                audioElement.muted = true;
                volumeBtn.innerHTML = '<i class="fas fa-volume-mute"></i>';
                volumeProgress.style.width = '0%';
            }
        });
        
        // Volume slider click
        volumeSlider.addEventListener('click', (e) => {
            const sliderWidth = volumeSlider.clientWidth;
            const clickPosition = e.offsetX;
            const newVolume = clickPosition / sliderWidth;
            
            audioElement.volume = newVolume;
            volumeProgress.style.width = (newVolume * 100) + '%';
            
            // Update volume icon
            updateVolumeIcon(newVolume);
        });
        
        // Update time and progress
        audioElement.addEventListener('timeupdate', () => {
            const currentTimeValue = audioElement.currentTime;
            const durationValue = audioElement.duration;
            
            // Update current time display
            currentTime.textContent = formatTime(currentTimeValue);
            
            // Update progress bar
            const progressPercentage = (currentTimeValue / durationValue) * 100;
            progress.style.width = progressPercentage + '%';
        });
        
        // When audio ends
        audioElement.addEventListener('ended', () => {
            playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
            isPlaying = false;
            audioElement.currentTime = 0;
            
            // Stop visualization animation
            if (animationFrameId) {
                cancelAnimationFrame(animationFrameId);
            }
            
            // Reset bars
            visualizationBars.forEach(bar => {
                bar.style.height = '5px';
            });
        });
        
        // Format time function (converts seconds to MM:SS format)
        function formatTime(seconds) {
            if (isNaN(seconds)) return "0:00";
            
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = Math.floor(seconds % 60);
            
            return `${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;
        }
        
        // Update volume icon based on volume level
        function updateVolumeIcon(volume) {
            if (volume === 0 || audioElement.muted) {
                volumeBtn.innerHTML = '<i class="fas fa-volume-mute"></i>';
            } else if (volume < 0.5) {
                volumeBtn.innerHTML = '<i class="fas fa-volume-down"></i>';
            } else {
                volumeBtn.innerHTML = '<i class="fas fa-volume-up"></i>';
            }
        }
        
        // Animation for visualization bars
        function animateVisualizationBars() {
            if (!isPlaying) {
                // Reset bars when not playing
                visualizationBars.forEach(bar => {
                    bar.style.height = '5px';
                });
                return;
            }
            
            visualizationBars.forEach(bar => {
                // Create random heights for the bars when audio is playing
                const height = isPlaying ? 5 + Math.random() * 35 : 5;
                bar.style.height = `${height}px`;
            });
          
          // Continue animation loop for visualization bars
            animationFrameId = requestAnimationFrame(animateVisualizationBars);
        }
        
        // Set initial volume
        audioElement.volume = 0.75;
        volumeProgress.style.width = '75%';
    }

    // Main function to convert TikTok to MP3
    async function convertTikTokToMp3() {
        const url = elements.urlInput.value.trim();
        
        // Validate URL
        if (!url) {
            showToast('Error', 'Please enter a TikTok URL', 'error');
            return;
        }
        
        if (!isValidTikTokUrl(url)) {
            showToast('Invalid URL', 'Please enter a valid TikTok URL', 'error');
            return;
        }
        
        // Check if Turnstile token is available
        if (!turnstileToken) {
            showToast('Verification Required', 'Please complete the verification challenge', 'warning');
            return;
        }
        
        // Reset UI and start conversion process
        resetUI();
        hideError();
        
        // Update button state
        elements.convertBtn.disabled = true;
        elements.convertBtn.textContent = 'Converting...';
        elements.convertBtn.classList.add('processing');
        
        // Show progress container
        elements.progressContainer.classList.add('visible');
        elements.progressStatus.textContent = CONVERSION_STAGES[0].message;
        elements.progressText.textContent = CONVERSION_STAGES[0].subtext;
        
        // Track conversion start time
        conversionStartTime = Date.now();
        conversionPhase = 'converting';
        conversionInProgress = true;
        
        // Start progress animation
        progressTimer = startProgressAnimation();
        
        try {
            logDebug(`Starting conversion for URL: ${url}`);
            
            // Prepare request data
            const requestData = {
                url: url,
                turnstileToken: turnstileToken
            };
            
            // Make API request
            const response = await fetch(API_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(requestData)
            });
            
            // Clear progress animation
            clearInterval(progressTimer);
            
            // Handle error responses
            if (!response.ok) {
                let errorData = { message: 'Unknown error occurred' };
                
                try {
                    errorData = await response.json();
                } catch (e) {
                    console.error('Failed to parse error response:', e);
                }
                
                const errorMessage = handleError(errorData, response);
                
                logDebug(`API error: ${errorMessage}`);
                showError(errorMessage);
                
                // Reset button state
                elements.convertBtn.disabled = false;
                elements.convertBtn.textContent = 'Convert Now';
                elements.convertBtn.classList.remove('processing');
                
                // Reset Turnstile
                resetTurnstile();
                
                return;
            }
            
            // Get audio file details and blob
            const audioBlob = await response.blob();
            
            // Extract filename from headers or generate one
            convertedFileName = getFilenameFromResponse(response) || 'tiktok-audio.mp3';
            
            logDebug(`Conversion successful. Filename: ${convertedFileName}`);
            
            // Complete the progress bar
            elements.progressBarInner.style.width = '100%';
            elements.progressPercentage.textContent = '100%';
            elements.progressStatus.textContent = 'Conversion Complete!';
            elements.progressText.textContent = 'Ready to download';
            
            // Get metadata from response if available
            let metadata = {};
            try {
                const metadataHeader = response.headers.get('X-Audio-Metadata');
                if (metadataHeader) {
                    metadata = JSON.parse(decodeURIComponent(metadataHeader));
                    logDebug('Metadata received:', metadata);
                }
            } catch (e) {
                console.error('Failed to parse metadata:', e);
            }
            
            // Create object URL for download
            const audioUrl = URL.createObjectURL(audioBlob);
            
            // Update download section
            elements.downloadLink.href = audioUrl;
            elements.downloadLink.download = convertedFileName;
            
            // Update audio info if available
            if (elements.audioTitleEl) {
                elements.audioTitleEl.textContent = metadata.title || 'TikTok Audio';
            }
            if (elements.audioAuthorEl) {
                elements.audioAuthorEl.textContent = metadata.author || 'Unknown Author';
            }
            if (elements.audioDurationEl) {
                elements.audioDurationEl.textContent = formatDuration(metadata.duration);
            }
            
            // Show download section after a short delay for better UX
            setTimeout(() => {
                elements.downloadSection.classList.add('visible');
                
                // Scroll to download section
                smoothScrollTo(elements.downloadSection);
                
                // Show success toast
                showToast('Success', 'TikTok successfully converted to MP3!', 'success');
                
                // Add enhanced audio player with visualization if container exists
                if (elements.audioPlayer) {
                    // Insert the audio player HTML
                    elements.audioPlayer.innerHTML = createAudioPlayer();
                    elements.audioPlayer.classList.add('visible');
                    
                    // Initialize the audio player
                    initAudioPlayer();
                    
                    // Set audio source
                    const audioElement = document.getElementById('audio-element');
                    if (audioElement) {
                        audioElement.src = audioUrl;
                    }
                }
                
                // Reset conversion state and button
                conversionPhase = 'complete';
                elements.convertBtn.textContent = 'Convert New';
                elements.convertBtn.disabled = false;
                elements.convertBtn.classList.remove('processing');
                
                // Reset Turnstile for next conversion
                resetTurnstile();
                
                // Track conversion in analytics if available
                if (window.gtag) {
                    window.gtag('event', 'conversion_complete', {
                        'event_category': 'conversion',
                        'event_label': 'tiktok_to_mp3'
                    });
                }
                
                // Auto-download if setting enabled
                const autoDownload = localStorage.getItem('autoDownload') === 'true';
                if (autoDownload) {
                    logDebug('Auto-download enabled, triggering download');
                    elements.downloadLink.click();
                }
            }, 1000);
            
        } catch (error) {
            console.error('Conversion error:', error);
            
            // Clear progress animation
            clearInterval(progressTimer);
            
            // Show error message
            const errorMessage = 'Failed to connect to the server. Please check your internet connection and try again.';
            showError(errorMessage);
            
            // Reset button state
            elements.convertBtn.disabled = false;
            elements.convertBtn.textContent = 'Convert Now';
            elements.convertBtn.classList.remove('processing');
            
            // Reset Turnstile
            resetTurnstile();
            
            // Log error in analytics if available
            if (window.gtag) {
                window.gtag('event', 'conversion_error', {
                    'event_category': 'error',
                    'event_label': error.message || 'unknown_error'
                });
            }
        }
    }
    
    // Check for URL parameters on page load
    window.addEventListener('load', function() {
        const urlParams = new URLSearchParams(window.location.search);
        const tiktokUrl = urlParams.get('url');
        
        if (tiktokUrl && isValidTikTokUrl(tiktokUrl)) {
            elements.urlInput.value = tiktokUrl;
            logDebug('TikTok URL found in query parameters');
            
            // Auto-convert if parameter is set
            if (urlParams.get('autoConvert') === 'true') {
                // Wait for Turnstile to initialize
                const checkTurnstile = setInterval(() => {
                    if (turnstileToken) {
                        clearInterval(checkTurnstile);
                        elements.convertBtn.click();
                    }
                }, 500);
                
                // Set a timeout in case Turnstile doesn't load
                setTimeout(() => {
                    clearInterval(checkTurnstile);
                }, 10000);
            }
        }
    });
    
    // Setup periodic token refresh for Turnstile
    setInterval(() => {
        if (window.turnstile && turnstileWidget) {
            window.turnstile.reset(turnstileWidget);
        }
    }, 3600000); // Refresh token every hour
});

// Add page load performance tracking
window.addEventListener('load', function() {
    setTimeout(function() {
        if (window.performance) {
            const perfData = window.performance.timing;
            const pageLoadTime = perfData.loadEventEnd - perfData.navigationStart;
            
            console.log('Page load time:', pageLoadTime + 'ms');
            
            // Track page load time in analytics if available
            if (window.gtag) {
                window.gtag('event', 'page_performance', {
                    'event_category': 'performance',
                    'event_label': 'page_load',
                    'value': Math.round(pageLoadTime)
                });
            }
        }
    }, 0);
});

// Service worker registration for PWA support
if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
        navigator.serviceWorker.register('/service-worker.js')
            .then(registration => {
                console.log('ServiceWorker registered with scope:', registration.scope);
            })
            .catch(error => {
                console.log('ServiceWorker registration failed:', error);
            });
    });
}
</script>
</body>
</html>
