<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>TikTok Video Downloader</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f5f5f5;
            text-align: center;
            margin-top: 50px;
        }
        input, button {
            padding: 10px;
            margin: 10px;
            font-size: 16px;
        }
        #result {
            margin-top: 20px;
        }
        video {
            max-width: 100%;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
    </style>
</head>

<body>

    <h1>TikTok Video Downloader</h1>
    <input type="text" id="urlInput" placeholder="Enter TikTok URL">
    <button onclick="downloadTikTok()">Download Video</button>

    <div id="result"></div>

  <script>
async function downloadTikTok() {
    const url = document.getElementById('urlInput').value.trim();
    if (!url) return alert('Please enter a valid TikTok URL');
    
    // Use the complete WordPress REST API endpoint
    const apiEndpoint = 'https://denmara.com/wp-json/tiktok/v1/download';
    
    document.getElementById('result').innerHTML = '<p>Loading...</p>';
    
    try {
        console.log('Sending request with URL:', url);
        
        const response = await fetch(apiEndpoint, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ url }),
            // Don't use credentials unless you need them for authentication
            // credentials: 'include'
        });
        
        // Get response text first to inspect what was returned
        const responseText = await response.text();
        console.log('Response status:', response.status);
        console.log('Response text:', responseText);
        
        // Try to parse as JSON if possible
        let data;
        try {
            data = JSON.parse(responseText);
        } catch (e) {
            console.error('Failed to parse response as JSON:', e);
            throw new Error(`Server returned invalid JSON. Status: ${response.status}`);
        }
        
        if (!data.success) {
            alert(data.error || 'Error fetching video.');
            document.getElementById('result').innerHTML = '';
            return;
        }
        
        document.getElementById('result').innerHTML = `
            <h2>Video Preview:</h2>
            <video controls class="w-full max-w-md">
                <source src="${data.video_url}" type="video/mp4">
                Your browser does not support the video tag.
            </video>
            <p><strong>Author:</strong> ${data.author}</p>
            <p><strong>Description:</strong> ${data.desc}</p>
            <a href="${data.video_url}" class="btn btn-primary" download="tiktok-video.mp4">Download Video</a>
        `;
    } catch (error) {
        alert(`An error occurred: ${error.message}`);
        console.error('Error details:', error);
        document.getElementById('result').innerHTML = '';
    }
}
</script>

</body>

</html>
